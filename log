=== Docker build Dockerfile.client
[2018-01-22 21:14.48] Starting...
Cloning into '/tmp/with_clone251c4e48'...
done.
warning: remote HEAD refers to nonexistent ref, unable to checkout.

HEAD is now at b00a5e1 Dockerfile.ci: Fix opam dependencies
Sending build context to Docker daemon 557.1 kBSending build context to Docker daemon 1.114 MBSending build context to Docker daemon 1.671 MBSending build context to Docker daemon 2.228 MBSending build context to Docker daemon 2.785 MBSending build context to Docker daemon 3.342 MBSending build context to Docker daemon 3.899 MBSending build context to Docker daemon 4.456 MBSending build context to Docker daemon 5.014 MBSending build context to Docker daemon 5.571 MBSending build context to Docker daemon 6.128 MBSending build context to Docker daemon 6.685 MBSending build context to Docker daemon 7.242 MBSending build context to Docker daemon 7.799 MBSending build context to Docker daemon 8.356 MBSending build context to Docker daemon 8.913 MBSending build context to Docker daemon 9.173 MB
Step 1/16 : FROM ocaml/opam-dev:alpine-3.5_ocaml-4.05.0
alpine-3.5_ocaml-4.05.0: Pulling from ocaml/opam-dev
Digest: sha256:56eabc77608dac440c0907a0d3d3c2fbff0d65141b20dc5296783c21d42310d3
Status: Image is up to date for ocaml/opam-dev:alpine-3.5_ocaml-4.05.0
 ---> 1b9232af4c8c
Step 2/16 : RUN sudo apk add --no-cache tzdata aspcud gmp-dev perl libev-dev m4
 ---> Using cache
 ---> 7cebf263445f
Step 3/16 : RUN git -C /home/opam/opam-repository fetch origin &&     git -C /home/opam/opam-repository reset beba7fea --hard &&     opam update -u
 ---> Using cache
 ---> 420eb064f084
Step 4/16 : ENV OPAMERRLOGLEN 0 OPAMYES 1
 ---> Using cache
 ---> 6dfc56df9171
Step 5/16 : RUN opam install alcotest lwt conf-libev inotify
 ---> Using cache
 ---> 9eabfdd7161d
Step 6/16 : COPY check-libev.ml /tmp/check-libev.ml
 ---> Using cache
 ---> 3fd748d4a302
Step 7/16 : RUN opam config exec -- ocaml /tmp/check-libev.ml
 ---> Using cache
 ---> 9e23d4d84433
Step 8/16 : COPY *.opam /home/opam/src/datakit/
 ---> Using cache
 ---> e4c6f4885e6f
Step 9/16 : RUN opam pin add /home/opam/src/datakit/ -n
 ---> Using cache
 ---> 6ab53e08a85d
Step 10/16 : RUN opam install datakit-client-git datakit-client-9p --deps -t
 ---> Using cache
 ---> e27b3a679f5f
Step 11/16 : COPY . /home/opam/src/datakit
 ---> 3fe9e3a7c3de
Removing intermediate container fd7eab666290
Step 12/16 : RUN sudo chown opam.nogroup -R /home/opam/src/datakit
 ---> Running in 2dab327054d6
 ---> 3e2d24db5b74
Error removing intermediate container 2dab327054d6: Driver aufs failed to remove root filesystem 2dab327054d67e740745721a7ca93819ce5872e7073543731a9d69d19a97436f: rename /var/lib/docker/aufs/mnt/f39d8c745ce7ab3ceb19f9a9f1b69d2762ddcca95098e31590eb2e600e9c93aa /var/lib/docker/aufs/mnt/f39d8c745ce7ab3ceb19f9a9f1b69d2762ddcca95098e31590eb2e600e9c93aa-removing: device or resource busy
Step 13/16 : RUN opam update --dev && opam upgrade
 ---> Running in c5e0f62fb627

=-=- Synchronising development packages -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[datakit.0.11.0] synchronised from file:///home/opam/src/datakit
[datakit-bridge-github.0.11.0] synchronised from file:///home/opam/src/datakit
[datakit-bridge-local-git.0.11.0] synchronised from file:///home/opam/src/datakit
[datakit-ci.0.11.0] synchronised from file:///home/opam/src/datakit
[datakit-client.0.11.0] synchronised from file:///home/opam/src/datakit
[datakit-client-9p.0.11.0] synchronised from file:///home/opam/src/datakit
[datakit-client-git.0.11.0] synchronised from file:///home/opam/src/datakit
[datakit-github.0.11.0] synchronised from file:///home/opam/src/datakit
[datakit-server.0.11.0] synchronised from file:///home/opam/src/datakit
[datakit-server-9p.0.11.0] synchronised from file:///home/opam/src/datakit
[datakit] Conflicting update of the metadata from file:///home/opam/src/datakit.
Override files in /home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/overlay/datakit (there will be a backup) ? [Y/n] y
User metadata backed up in /home/opam/.opam/backup/datakit.bak
[datakit-bridge-github] Conflicting update of the metadata from file:///home/opam/src/datakit.
Override files in /home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/overlay/datakit-bridge-github (there will be a backup) ? [Y/n] y
User metadata backed up in /home/opam/.opam/backup/datakit-bridge-github.bak
[datakit-bridge-local-git] Conflicting update of the metadata from file:///home/opam/src/datakit.
Override files in /home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/overlay/datakit-bridge-local-git (there will be a backup) ? [Y/n] y
User metadata backed up in /home/opam/.opam/backup/datakit-bridge-local-git.bak
[datakit-ci] Conflicting update of the metadata from file:///home/opam/src/datakit.
Override files in /home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/overlay/datakit-ci (there will be a backup) ? [Y/n] y
User metadata backed up in /home/opam/.opam/backup/datakit-ci.bak
[datakit-client] Conflicting update of the metadata from file:///home/opam/src/datakit.
Override files in /home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/overlay/datakit-client (there will be a backup) ? [Y/n] y
User metadata backed up in /home/opam/.opam/backup/datakit-client.bak
[datakit-client-9p] Conflicting update of the metadata from file:///home/opam/src/datakit.
Override files in /home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/overlay/datakit-client-9p (there will be a backup) ? [Y/n] y
User metadata backed up in /home/opam/.opam/backup/datakit-client-9p.bak
[datakit-client-git] Conflicting update of the metadata from file:///home/opam/src/datakit.
Override files in /home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/overlay/datakit-client-git (there will be a backup) ? [Y/n] y
User metadata backed up in /home/opam/.opam/backup/datakit-client-git.bak
[datakit-github] Conflicting update of the metadata from file:///home/opam/src/datakit.
Override files in /home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/overlay/datakit-github (there will be a backup) ? [Y/n] y
User metadata backed up in /home/opam/.opam/backup/datakit-github.bak
[datakit-server] Conflicting update of the metadata from file:///home/opam/src/datakit.
Override files in /home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/overlay/datakit-server (there will be a backup) ? [Y/n] y
User metadata backed up in /home/opam/.opam/backup/datakit-server.bak
[datakit-server-9p] Conflicting update of the metadata from file:///home/opam/src/datakit.
Override files in /home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/overlay/datakit-server-9p (there will be a backup) ? [Y/n] y
User metadata backed up in /home/opam/.opam/backup/datakit-server-9p.bak
Now run 'opam upgrade' to apply any package updates.
The following actions will be performed:
  - recompile datakit-client 0.11.0* [upstream changes]

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
-> removed   datakit-client.0.11.0
-> installed datakit-client.0.11.0
Done.
# Run eval $(opam env) to update the current shell environment
 ---> 15b29a92df60
Error removing intermediate container 2dab327054d6: No such container: 2dab327054d67e740745721a7ca93819ce5872e7073543731a9d69d19a97436f
Step 14/16 : RUN opam install datakit-client-9p datakit-client-git -tyv
 ---> Running in 2c23cc5fef29

=-=- Synchronising pinned packages =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Processing  1/2: [datakit-client-9p.0.11.0: rsync]
Processing  2/2: [datakit-client-9p.0.11.0: rsync] [datakit-client-git.0.11.0: rsync]
[datakit-client-9p.0.11.0] no changes from file:///home/opam/src/datakit
Processing  2/2: [datakit-client-git.0.11.0: rsync]
[datakit-client-git.0.11.0] no changes from file:///home/opam/src/datakit

The following actions will be performed:
  - install datakit-client-9p  0.11.0* 
  - install datakit-client-git 0.11.0* 
===== 2 to install =====

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Processing  1/4: [datakit-client-9p: jbuilder build]
+ /home/opam/.opam/ocaml-base-compiler.4.05.0/bin/jbuilder "build" "-p" "datakit-client-9p" "-j" "1" (CWD=/home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/build/datakit-client-9p.0.11.0)
-     ocamldep api/ocaml/9p/mount/mount.depends.ocamldep-output
-     ocamldep api/ocaml/9p/datakit_client_9p.depends.ocamldep-output
-     ocamldep api/ocaml/9p/datakit_client_9p.dependsi.ocamldep-output
-       ocamlc api/ocaml/9p/mount/version.{cmi,cmo,cmt}
-       ocamlc api/ocaml/9p/datakit_client_9p.{cmi,cmti}
-     ocamlopt api/ocaml/9p/mount/version.{cmx,o}
-       ocamlc api/ocaml/9p/mount/mount.{cmi,cmo,cmt}
-       ocamlc api/ocaml/9p/datakit_client_9p.{cmo,cmt}
-     ocamlopt api/ocaml/9p/datakit_client_9p.{cmx,o}
-     ocamlopt api/ocaml/9p/mount/mount.{cmx,o}
-       ocamlc api/ocaml/9p/datakit_client_9p.cma
-     ocamlopt api/ocaml/9p/datakit_client_9p.{a,cmxa}
-     ocamlopt api/ocaml/9p/mount/mount.exe
-     ocamlopt api/ocaml/9p/datakit_client_9p.cmxs
-> compiled  datakit-client-9p.0.11.0
Processing  2/4: [datakit-client-git: jbuilder build]
+ /home/opam/.opam/ocaml-base-compiler.4.05.0/bin/jbuilder "build" "-p" "datakit-client-git" "-j" "1" (CWD=/home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/build/datakit-client-git.0.11.0)
-     ocamldep api/ocaml/git/datakit_client_git.depends.ocamldep-output
-     ocamldep api/ocaml/git/datakit_client_git.dependsi.ocamldep-output
-       ocamlc api/ocaml/git/datakit_client_git.{cmi,cmti}
-       ocamlc api/ocaml/git/datakit_client_git.{cmo,cmt}
-     ocamlopt api/ocaml/git/datakit_client_git.{cmx,o}
-       ocamlc api/ocaml/git/datakit_client_git.cma
-     ocamlopt api/ocaml/git/datakit_client_git.{a,cmxa}
-     ocamlopt api/ocaml/git/datakit_client_git.cmxs
Processing  2/4: [datakit-client-git: jbuilder runtest]
+ /home/opam/.opam/ocaml-base-compiler.4.05.0/bin/jbuilder "runtest" "tests/datakit-git" (CWD=/home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/build/datakit-client-git.0.11.0)
-     ocamldep tests/datakit-git/test.depends.ocamldep-output
-     ocamldep api/ocaml/datakit_client.depends.ocamldep-output
-     ocamldep api/ocaml/datakit_client.dependsi.ocamldep-output
-     ocamldep src/datakit-io/datakit_io.depends.ocamldep-output
-     ocamldep src/datakit-io/datakit_io.dependsi.ocamldep-output
-     ocamldep tests/common/test.depends.ocamldep-output
-     ocamldep tests/common/test.dependsi.ocamldep-output
-     ocamldep tests/datakit-git/test.dependsi.ocamldep-output
-       ocamlc src/datakit-io/datakit_io.{cmi,cmti}
-       ocamlc api/ocaml/datakit_client.{cmi,cmti}
-       ocamlc api/ocaml/git/datakit_client_git.{cmi,cmti}
-       ocamlc tests/common/test_client.{cmi,cmti}
-     ocamlopt api/ocaml/datakit_client.{cmx,o}
-     ocamlopt api/ocaml/datakit_client.{a,cmxa}
-       ocamlc tests/common/test_utils.{cmi,cmo,cmt}
-     ocamlopt src/datakit-io/datakit_io.{cmx,o}
-       ocamlc tests/datakit-git/test.{cmi,cmti}
-     ocamlopt src/datakit-io/datakit_io.{a,cmxa}
-     ocamlopt tests/common/test_utils.{cmx,o}
-     ocamlopt api/ocaml/git/datakit_client_git.{cmx,o}
-     ocamlopt tests/common/test_client.{cmx,o}
-     ocamlopt tests/common/test.{a,cmxa}
-     ocamlopt tests/datakit-git/test.{cmx,o}
-     ocamlopt tests/datakit-git/test.exe
-         test alias tests/datakit-git/runtest
- /bin/sh: tput: not found
- stty: standard input: Not a tty
- Testing datakit-git.
- [33m ...[m                [36mclient[m          0   Transaction.[32m[OK][m                [36mclient[m          0   Transaction.
- [33m ...[m                [36mclient[m          1   Watch.[32m[OK][m                [36mclient[m          1   Watch.
- [33m ...[m                [36mclient[m          2   Make dirs.[32m[OK][m                [36mclient[m          2   Make dirs.
- [33m ...[m                [36mclient[m          3   Truncate.[32m[OK][m                [36mclient[m          3   Truncate.
- [33m ...[m                [36mclient[m          4   Parents.[32m[OK][m                [36mclient[m          4   Parents.
- [33m ...[m                [36mclient[m          5   Merge.[32m[OK][m                [36mclient[m          5   Merge.
- [33m ...[m                [36mclient[m          6   Diff.[32m[OK][m                [36mclient[m          6   Diff.
- [33m ...[m                [36mclient[m          7   Merge_metadata.[32m[OK][m                [36mclient[m          7   Merge_metadata.
- [33m ...[m                [36mclient[m          8   Merge empty.[32m[OK][m                [36mclient[m          8   Merge empty.
- [33m ...[m                [36mclient[m          9   Conflicts.[32m[OK][m                [36mclient[m          9   Conflicts.
- [33m ...[m                [36mclient[m         10   Large write.[32m[OK][m                [36mclient[m         10   Large write.
- [33m ...[m                [36mclient[m         11   Remove.[32m[OK][m                [36mclient[m         11   Remove.
- [33m ...[m                [36mclient[m         12   Remotes.[33m[SKIP][m              [36mclient[m         12   Remotes.
- [33m ...[m                [36mclient[m         13   Create_or_replace.[33m[SKIP][m              [36mclient[m         13   Create_or_replace.
- The full test results are available in `_build/_tests`.
- [32mTest Successful[m in 0.484s. 12 tests run.
-> compiled  datakit-client-git.0.11.0
-> installed datakit-client-9p.0.11.0
-> installed datakit-client-git.0.11.0
Done.
# Run eval $(opam env) to update the current shell environment
 ---> bd46b660ea14
Error removing intermediate container 2dab327054d6: No such container: 2dab327054d67e740745721a7ca93819ce5872e7073543731a9d69d19a97436f
Step 15/16 : RUN sudo mkdir /data && sudo chown opam.nogroup /data && chmod 700 /data &&     sudo cp $(opam config exec -- which datakit-mount) /usr/bin/datakit-mount
 ---> Running in f0245e188612
 ---> 6d29952998eb
Error removing intermediate container 2dab327054d6: No such container: 2dab327054d67e740745721a7ca93819ce5872e7073543731a9d69d19a97436f
Step 16/16 : CMD bash -c "/usr/bin/datakit-mount -h $(getent hosts datakit | awk '{print $1}')";     bash
 ---> Running in 0f9929156e11
 ---> 5f1b74bfeedd
Error removing intermediate container 2dab327054d6: No such container: 2dab327054d67e740745721a7ca93819ce5872e7073543731a9d69d19a97436f
Successfully built 5f1b74bfeedd
[2018-01-22 21:15.44] Success
