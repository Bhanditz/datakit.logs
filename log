=== Docker build Dockerfile.github
[2017-05-02 09:49.17] Starting...
Cloning into '/tmp/with_clone1e8958f2'...
done.
warning: remote HEAD refers to nonexistent ref, unable to checkout.

HEAD is now at 9a8cbad Merge pull request #544 from samoht/deps
Sending build context to Docker daemon 557.1 kBSending build context to Docker daemon 1.114 MBSending build context to Docker daemon 1.671 MBSending build context to Docker daemon 2.228 MBSending build context to Docker daemon 2.785 MBSending build context to Docker daemon 3.342 MBSending build context to Docker daemon 3.899 MBSending build context to Docker daemon 4.456 MBSending build context to Docker daemon 5.014 MBSending build context to Docker daemon 5.515 MB
Step 1/31 : FROM ocaml/opam-dev@sha256:337fd0f78b182a12da3f66d9d5ca075dbb79df414fc01d6a0aee99ffeb35552a
sha256:337fd0f78b182a12da3f66d9d5ca075dbb79df414fc01d6a0aee99ffeb35552a: Pulling from ocaml/opam-dev
Digest: sha256:337fd0f78b182a12da3f66d9d5ca075dbb79df414fc01d6a0aee99ffeb35552a
Status: Image is up to date for ocaml/opam-dev@sha256:337fd0f78b182a12da3f66d9d5ca075dbb79df414fc01d6a0aee99ffeb35552a
 ---> 9107a2254d1d
Step 2/31 : ENV OPAMERRLOGLEN 0 OPAMYES 1
 ---> Using cache
 ---> 90b67f82c489
Step 3/31 : RUN sudo apk add tzdata aspcud
 ---> Using cache
 ---> 1a4e4ce8b7ee
Step 4/31 : RUN opam pin add hvsock.0.14.0 -n https://github.com/mirage/ocaml-hvsock.git#88397c37a910c61507a9655ed8413c1692294da0
 ---> Using cache
 ---> afaec49f149c
Step 5/31 : RUN opam pin add irmin.1.1.0 -n https://github.com/mirage/irmin.git#89196ad17c53b02f333022a87ecc264ec8c06af0
 ---> Using cache
 ---> e276a27b48b0
Step 6/31 : RUN opam pin add irmin-git.1.1.0 -n https://github.com/mirage/irmin.git#89196ad17c53b02f333022a87ecc264ec8c06af0
 ---> Using cache
 ---> ba98ccd23980
Step 7/31 : RUN opam pin add -yn protocol-9p.0.9.0 'https://github.com/talex5/ocaml-9p.git#ping-mirage-3'
 ---> Using cache
 ---> 4e1e4eeea715
Step 8/31 : RUN opam pin add github --dev -n
 ---> Using cache
 ---> 22140a5e2ca1
Step 9/31 : RUN opam depext -ui lwt inotify alcotest conf-libev lambda-term cmdliner github protocol-9p rresult prometheus-app asl win-eventlog mtime hex github-hooks hvsock camlzip irmin-watcher git irmin
 ---> Using cache
 ---> 73a2aad730be
Step 10/31 : COPY check-libev.ml /tmp/check-libev.ml
 ---> Using cache
 ---> 5a52f7d7f052
Step 11/31 : RUN opam config exec -- ocaml /tmp/check-libev.ml
 ---> Using cache
 ---> 289972072f5d
Step 12/31 : COPY datakit.opam /home/opam/src/datakit/datakit.opam
 ---> Using cache
 ---> b7c593a07561
Step 13/31 : COPY datakit-client.opam /home/opam/src/datakit/datakit-client.opam
 ---> Using cache
 ---> c7bc7e6c99d3
Step 14/31 : COPY datakit-server.opam /home/opam/src/datakit/datakit-server.opam
 ---> Using cache
 ---> 5b1afa6b6531
Step 15/31 : COPY datakit-github.opam /home/opam/src/datakit/datakit-github.opam
 ---> Using cache
 ---> af5d93f47d29
Step 16/31 : COPY datakit-bridge-github.opam /home/opam/src/datakit/datakit-bridge-github.opam
 ---> Using cache
 ---> ef2265af7c50
Step 17/31 : RUN opam pin add datakit.dev /home/opam/src/datakit -yn &&     opam pin add datakit-server.dev /home/opam/src/datakit -yn &&     opam pin add datakit-client.dev /home/opam/src/datakit -yn &&     opam pin add datakit-github.dev /home/opam/src/datakit -yn &&     opam pin add datakit-bridge-github.dev /home/opam/src/datakit -yn
 ---> Using cache
 ---> bab3bf18c252
Step 18/31 : COPY . /home/opam/src/datakit
 ---> 726b9ea49a51
Error removing intermediate container ea0579de6653: Driver aufs failed to remove root filesystem ea0579de6653456d2a4b630cfac3b74648b9dfaf3e91303fed13ce7f2992833a: rename /var/lib/docker/aufs/mnt/5ee9f3ec883184acad1577d11d5a68f3f733f8665220a9baa9149a620cbc8c3e /var/lib/docker/aufs/mnt/5ee9f3ec883184acad1577d11d5a68f3f733f8665220a9baa9149a620cbc8c3e-removing: device or resource busy
Step 19/31 : RUN sudo chown opam.nogroup -R /home/opam/src/datakit
 ---> Running in d5bb3f435a44
 ---> e948ef6c1438
Error removing intermediate container ea0579de6653: No such container: ea0579de6653456d2a4b630cfac3b74648b9dfaf3e91303fed13ce7f2992833a
Step 20/31 : RUN cd /home/opam/src/datakit &&     scripts/watermark.sh &&     git status --porcelain
 ---> Running in 8a52a0beaaaf
 M src/version.ml
 ---> abc4b1b3df10
Error removing intermediate container ea0579de6653: No such container: ea0579de6653456d2a4b630cfac3b74648b9dfaf3e91303fed13ce7f2992833a
Step 21/31 : RUN opam install datakit
 ---> Running in f3195617f7dd

=-=- Synchronising pinned packages =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[datakit.dev] synchronised from file:///home/opam/src/datakit

The following actions will be performed:
  - install irmin-git      1.1.0*                               [required by datakit]
  - install datakit-server dev*                                 [required by datakit]
  - install datakit        dev*
===== 3 to install =====
[datakit.dev] synchronised from file:///home/opam/src/datakit
[datakit-server.dev] synchronised from file:///home/opam/src/datakit
[irmin-git.1.1.0] synchronised from git+https://github.com/mirage/irmin.git#89196ad17c53b02f333022a87ecc264ec8c06af0

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
-> installed datakit-server.dev
-> installed irmin-git.1.1.0
-> installed datakit.dev
Done.
# Run eval `opam env` to update the current shell environment
 ---> 15758069896a
Error removing intermediate container ea0579de6653: No such container: ea0579de6653456d2a4b630cfac3b74648b9dfaf3e91303fed13ce7f2992833a
Step 22/31 : RUN opam install datakit-bridge-github -ytv
 ---> Running in 72464fb67ee3

=-=- Synchronising pinned packages =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Processing  1/1: [datakit-bridge-github.dev: rsync]
[datakit-bridge-github.dev] synchronised from file:///home/opam/src/datakit

The following actions will be performed:
  - install datakit-client        dev*                          [required by datakit-bridge-github]
  - install datakit-github        dev*                          [required by datakit-bridge-github]
  - install datakit-bridge-github dev*
===== 3 to install =====
Processing  1/3: [datakit-bridge-github.dev: rsync]
Processing  2/3: [datakit-bridge-github.dev: rsync] [datakit-client.dev: rsync]
Processing  3/3: [datakit-bridge-github.dev: rsync] [datakit-client.dev: rsync] [datakit-github.dev: rsync]
[datakit-bridge-github.dev] synchronised from file:///home/opam/src/datakit
Processing  3/3: [datakit-client.dev: rsync] [datakit-github.dev: rsync]
[datakit-client.dev] synchronised from file:///home/opam/src/datakit
Processing  3/3: [datakit-github.dev: rsync]
[datakit-github.dev] synchronised from file:///home/opam/src/datakit

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Processing  1/6: [datakit-client: jbuilder build]
+ jbuilder "build" "-p" "datakit-client" "-j" "1" (CWD=/home/opam/.opam/default/.opam-switch/build/datakit-client.dev)
-     ocamldep api/ocaml/bin/mount.depends.ocamldep-output
-     ocamldep api/ocaml/datakit_client.depends.ocamldep-output
-     ocamldep api/ocaml/datakit_client.dependsi.ocamldep-output
-       ocamlc api/ocaml/bin/version.{cmi,cmo,cmt}
-       ocamlc api/ocaml/datakit_path.{cmi,cmti}
-       ocamlc api/ocaml/bin/mount.{cmi,cmo,cmt}
-     ocamlopt api/ocaml/bin/version.{cmx,o}
-       ocamlc api/ocaml/datakit_path.{cmo,cmt}
-     ocamlopt api/ocaml/datakit_path.{cmx,o}
-       ocamlc api/ocaml/datakit_S.{cmi,cmo,cmt}
-     ocamlopt api/ocaml/bin/mount.{cmx,o}
-     ocamlopt api/ocaml/datakit_S.{cmx,o}
-       ocamlc api/ocaml/datakit_client_9p.{cmi,cmti}
-     ocamlopt api/ocaml/bin/mount.exe
-       ocamlc api/ocaml/datakit_client_9p.{cmo,cmt}
-     ocamlopt api/ocaml/datakit_client_9p.{cmx,o}
-       ocamlc api/ocaml/datakit_client.cma
-     ocamlopt api/ocaml/datakit_client.{a,cmxa}
-     ocamlopt api/ocaml/datakit_client.cmxs
-> compiled  datakit-client.dev
-> installed datakit-client.dev
Processing  3/6: [datakit-github: jbuilder build]
+ jbuilder "build" "-p" "datakit-github" "-j" "1" (CWD=/home/opam/.opam/default/.opam-switch/build/datakit-github.dev)
-     ocamldep src/datakit-github/datakit_github.depends.ocamldep-output
-     ocamldep src/datakit-github/datakit_github.dependsi.ocamldep-output
-       ocamlc src/datakit-github/datakit_github.{cmi,cmti}
-       ocamlc src/datakit-github/datakit_github.{cmo,cmt}
-     ocamlopt src/datakit-github/datakit_github.{cmx,o}
-       ocamlc src/datakit-github/datakit_github_conv.{cmi,cmti}
-       ocamlc src/datakit-github/datakit_github_conv.{cmo,cmt}
-     ocamlopt src/datakit-github/datakit_github_conv.{cmx,o}
-       ocamlc src/datakit-github/datakit_github.cma
-     ocamlopt src/datakit-github/datakit_github.{a,cmxa}
-     ocamlopt src/datakit-github/datakit_github.cmxs
-> compiled  datakit-github.dev
-> installed datakit-github.dev
Processing  5/6: [datakit-bridge-github: jbuilder build]
+ jbuilder "build" "-p" "datakit-bridge-github" "-j" "1" (CWD=/home/opam/.opam/default/.opam-switch/build/datakit-bridge-github.dev)
-     ocamldep bridge/github/main.depends.ocamldep-output
-     ocamldep bridge/github/datakit_bridge_github.depends.ocamldep-output
-     ocamldep bridge/github/main.dependsi.ocamldep-output
-     ocamldep bridge/github/datakit_bridge_github.dependsi.ocamldep-output
-     ocamldep src/datakit-log/datakit_log.dependsi.ocamldep-output
-     ocamldep src/datakit-log/datakit_log.depends.ocamldep-output
-       ocamlc bridge/github/datakit_github_api.{cmi,cmti}
-       ocamlc bridge/github/datakit_github_state.{cmi,cmti}
-       ocamlc bridge/github/datakit_github_sync.{cmi,cmti}
-       ocamlc src/datakit-log/datakit_log.{cmi,cmti}
-     ocamlopt bridge/github/datakit_github_api.{cmx,o}
-     ocamlopt bridge/github/datakit_github_state.{cmx,o}
-       ocamlc bridge/github/version.{cmi,cmo,cmt}
-       ocamlc bridge/github/main.{cmi,cmti}
-     ocamlopt src/datakit-log/datakit_log.{cmx,o}
-     ocamlopt bridge/github/datakit_github_sync.{cmx,o}
-     ocamlopt src/datakit-log/datakit_log.{a,cmxa}
-     ocamlopt bridge/github/datakit_bridge_github.{a,cmxa}
-     ocamlopt bridge/github/version.{cmx,o}
-     ocamlopt bridge/github/main.{cmx,o}
-     ocamlopt bridge/github/main.exe
Processing  5/6: [datakit-bridge-github: jbuilder runtest]
+ jbuilder "runtest" "tests/datakit-bridge-github" (CWD=/home/opam/.opam/default/.opam-switch/build/datakit-bridge-github.dev)
-     ocamldep tests/datakit-bridge-github/test.depends.ocamldep-output
-     ocamldep api/ocaml/datakit_client.dependsi.ocamldep-output
-     ocamldep src/datakit-server/datakit_server.dependsi.ocamldep-output
-     ocamldep src/datakit-github/datakit_github.dependsi.ocamldep-output
-     ocamldep api/ocaml/datakit_client.depends.ocamldep-output
-     ocamldep src/datakit-io/datakit_io.depends.ocamldep-output
-     ocamldep src/datakit-server/datakit_server.depends.ocamldep-output
-     ocamldep src/datakit-io/datakit_io.dependsi.ocamldep-output
-     ocamldep src/datakit-github/datakit_github.depends.ocamldep-output
-     ocamldep src/datakit/datakit.depends.ocamldep-output
-     ocamldep tests/common/test.depends.ocamldep-output
-     ocamldep src/datakit/datakit.dependsi.ocamldep-output
-     ocamldep tests/common/test.dependsi.ocamldep-output
-       ocamlc api/ocaml/datakit_path.{cmi,cmti}
-       ocamlc src/datakit-io/datakit_io.{cmi,cmti}
-       ocamlc src/datakit-server/vfs.{cmi,cmti}
-       ocamlc src/datakit-server/fs9p.{cmi,cmti}
-       ocamlc api/ocaml/datakit_S.{cmi,cmo,cmt}
-       ocamlc src/datakit-server/fs9p_error.{cmi,cmti}
-     ocamlopt api/ocaml/datakit_path.{cmx,o}
-       ocamlc api/ocaml/datakit_client_9p.{cmi,cmti}
-       ocamlc src/datakit/autopush.{cmi,cmo,cmt}
-       ocamlc src/datakit/ivfs_blob.{cmi,cmti}
-     ocamlopt api/ocaml/datakit_S.{cmx,o}
-       ocamlc src/datakit-github/datakit_github.{cmi,cmti}
-     ocamlopt src/datakit-server/vfs.{cmx,o}
-     ocamlopt src/datakit-io/datakit_io.{cmx,o}
-       ocamlc src/datakit-github/datakit_github_conv.{cmi,cmti}
-     ocamlopt src/datakit-io/datakit_io.{a,cmxa}
-     ocamlopt src/datakit-server/fs9p_error.{cmx,o}
-       ocamlc src/datakit/ivfs_tree.{cmi,cmti}
-       ocamlc bridge/github/datakit_github_api.{cmi,cmti}
-       ocamlc bridge/github/datakit_github_state.{cmi,cmti}
-       ocamlc bridge/github/datakit_github_sync.{cmi,cmti}
-       ocamlc src/datakit/ivfs.{cmi,cmti}
-       ocamlc src/datakit/ivfs_merge.{cmi,cmti}
-       ocamlc src/datakit/ivfs_remote.{cmi,cmti}
-     ocamlopt src/datakit-server/fs9p.{cmx,o}
-       ocamlc src/datakit/ivfs_rw.{cmi,cmti}
-     ocamlopt src/datakit-server/datakit_server.{a,cmxa}
-     ocamlopt api/ocaml/datakit_client_9p.{cmx,o}
-       ocamlc tests/common/test_client.{cmi,cmti}
-     ocamlopt api/ocaml/datakit_client.{a,cmxa}
-     ocamlopt src/datakit/autopush.{cmx,o}
-     ocamlopt src/datakit/ivfs_blob.{cmx,o}
-     ocamlopt src/datakit/ivfs_tree.{cmx,o}
-       ocamlc tests/common/test_utils.{cmi,cmo,cmt}
-     ocamlopt src/datakit/ivfs_merge.{cmx,o}
-     ocamlopt src/datakit/ivfs_remote.{cmx,o}
-     ocamlopt src/datakit/ivfs_rw.{cmx,o}
-     ocamlopt src/datakit-github/datakit_github.{cmx,o}
-       ocamlc tests/datakit-bridge-github/test.{cmi,cmo,cmt}
-     ocamlopt src/datakit/ivfs.{cmx,o}
-     ocamlopt src/datakit/datakit.{a,cmxa}
-     ocamlopt src/datakit-github/datakit_github_conv.{cmx,o}
-     ocamlopt src/datakit-github/datakit_github.{a,cmxa}
-     ocamlopt bridge/github/datakit_github_state.{cmx,o}
-     ocamlopt bridge/github/datakit_github_api.{cmx,o}
-     ocamlopt bridge/github/datakit_github_sync.{cmx,o}
-     ocamlopt bridge/github/datakit_bridge_github.{a,cmxa}
-     ocamlopt tests/common/test_utils.{cmx,o}
-     ocamlopt tests/common/test_client.{cmx,o}
-     ocamlopt tests/common/test.{a,cmxa}
-     ocamlopt tests/datakit-bridge-github/test.{cmx,o}
-     ocamlopt tests/datakit-bridge-github/test.exe
-         test alias tests/datakit-bridge-github/runtest
- /bin/sh: tput: not found
- stty: standard input: Not a tty
- Testing datakit-github.
-  ...                github          0   basic-snapshot.[OK]                github          0   basic-snapshot.
-  ...                github          1   snapshot.[OK]                github          1   snapshot.
-  ...                github          2   capabilities.[OK]                github          2   capabilities.
-  ...                github          3   cleanup.[OK]                github          3   cleanup.
-  ...                github          4   events.[OK]                github          4   events.
-  ...                github          5   updates.[OK]                github          5   updates.
-  ...                github          6   startup.[OK]                github          6   startup.
-  ...                github          7   random-github.[OK]                github          7   random-github.
-  ...                github          8   random-github-*.[SKIP]              github          8   random-github-*.
-  ...                github          9   random-datakit.[OK]                github          9   random-datakit.
-  ...                github         10   random-datakit-*.[SKIP]              github         10   random-datakit-*.
- The full test results are available in `_build/_tests`.
- Test Successful in 2.608s. 9 tests run.
-> compiled  datakit-bridge-github.dev
-> installed datakit-bridge-github.dev
Done.
# Run eval `opam env` to update the current shell environment
 ---> 2fb8d805a240
Removing intermediate container f3195617f7dd
Removing intermediate container 72464fb67ee3
Error removing intermediate container ea0579de6653: No such container: ea0579de6653456d2a4b630cfac3b74648b9dfaf3e91303fed13ce7f2992833a
Step 23/31 : RUN sudo cp $(opam config exec -- which datakit-bridge-github) /usr/bin/
 ---> Running in 6272faa9800c
 ---> b1c4fa3a9f85
Error removing intermediate container ea0579de6653: No such container: ea0579de6653456d2a4b630cfac3b74648b9dfaf3e91303fed13ce7f2992833a
Step 24/31 : USER root
 ---> Running in b9eb21cd4b9b
 ---> 551cc4dae90f
Error removing intermediate container ea0579de6653: No such container: ea0579de6653456d2a4b630cfac3b74648b9dfaf3e91303fed13ce7f2992833a
Step 25/31 : FROM alpine:3.5
3.5: Pulling from library/alpine
Digest: sha256:58e1a1bb75db1b5a24a462dd5e2915277ea06438c3f105138f97eb53149673c4
Status: Image is up to date for alpine:3.5
 ---> 4a415e366388
Removing intermediate container d5bb3f435a44
Removing intermediate container 8a52a0beaaaf
Removing intermediate container 6272faa9800c
Removing intermediate container b9eb21cd4b9b
Error removing intermediate container ea0579de6653: No such container: ea0579de6653456d2a4b630cfac3b74648b9dfaf3e91303fed13ce7f2992833a
Step 26/31 : RUN apk add --no-cache libev gmp tzdata ca-certificates
 ---> Using cache
 ---> 5da98e5d42ce
Error removing intermediate container ea0579de6653: No such container: ea0579de6653456d2a4b630cfac3b74648b9dfaf3e91303fed13ce7f2992833a
Step 27/31 : EXPOSE 5640
 ---> Using cache
 ---> bcff9a1ffcf9
Error removing intermediate container ea0579de6653: No such container: ea0579de6653456d2a4b630cfac3b74648b9dfaf3e91303fed13ce7f2992833a
Step 28/31 : EXPOSE 5641
 ---> Using cache
 ---> b744f37386bf
Error removing intermediate container ea0579de6653: No such container: ea0579de6653456d2a4b630cfac3b74648b9dfaf3e91303fed13ce7f2992833a
Step 29/31 : ENTRYPOINT /usr/bin/datakit-bridge-github
 ---> Using cache
 ---> 72d8275f4da2
Error removing intermediate container ea0579de6653: No such container: ea0579de6653456d2a4b630cfac3b74648b9dfaf3e91303fed13ce7f2992833a
Step 30/31 : CMD --listen=tcp://0.0.0.0:5641 -v --datakit=tcp:127.0.0.1:5640
 ---> Using cache
 ---> 2e61f29556ca
Error removing intermediate container ea0579de6653: No such container: ea0579de6653456d2a4b630cfac3b74648b9dfaf3e91303fed13ce7f2992833a
Step 31/31 : COPY --from=0 /usr/bin/datakit-bridge-github /usr/bin/datakit-bridge-github
 ---> b53a6b511160
Error removing intermediate container ea0579de6653: No such container: ea0579de6653456d2a4b630cfac3b74648b9dfaf3e91303fed13ce7f2992833a
Successfully built b53a6b511160
[2017-05-02 09:50.29] Success
