=== Docker build Dockerfile.bridge-local-git
[2017-01-25 15:07.35] Starting...
Cloning into '/tmp/with_clone3eea7f9f'...
done.
HEAD is now at 3745eac ci: use opam 2 for builds
[2017-01-25 15:07.35] Rewrite Dockerfile's first line to:
FROM sha256:f289b8fa3f0526044bde4e1deaac5a9bca028048da269234bc80f62e2d0e4755
Sending build context to Docker daemon 557.1 kBSending build context to Docker daemon 1.114 MBSending build context to Docker daemon 1.671 MBSending build context to Docker daemon 2.228 MBSending build context to Docker daemon 2.785 MBSending build context to Docker daemon 3.342 MBSending build context to Docker daemon 3.899 MBSending build context to Docker daemon 4.456 MBSending build context to Docker daemon 5.014 MBSending build context to Docker daemon 5.571 MBSending build context to Docker daemon 5.908 MB
Step 1/19 : FROM sha256:f289b8fa3f0526044bde4e1deaac5a9bca028048da269234bc80f62e2d0e4755
 ---> f289b8fa3f05
Step 2/19 : RUN opam pin add github --dev -n
 ---> Using cache
 ---> c6f1504b74be
Step 3/19 : RUN opam pin add prometheus.dev /home/opam/src/datakit -n
 ---> Using cache
 ---> 1b3e89d3a815
Step 4/19 : RUN opam pin add prometheus-app.dev /home/opam/src/datakit -n
 ---> Using cache
 ---> a60fe68b7188
Step 5/19 : RUN opam pin add datakit-github.dev /home/opam/src/datakit -n
 ---> Using cache
 ---> 73cabc522408
Step 6/19 : RUN opam depext datakit-github && opam install datakit-github --deps
 ---> Using cache
 ---> b2d693077244
Step 7/19 : COPY datakit-bridge-local-git.opam /home/opam/src/datakit/datakit-bridge-local-git.opam
 ---> Using cache
 ---> 32585efd658a
Step 8/19 : RUN opam pin add datakit-bridge-local-git.dev /home/opam/src/datakit -n
 ---> Using cache
 ---> 7d755248e8b7
Step 9/19 : RUN opam depext datakit-bridge-local-git && opam install datakit-bridge-local-git --deps
 ---> Running in 1d81e68b72c7
# Detecting depexts using flags: x86_64 linux alpine
# The following system packages are needed:
#  - gmp-dev
#  - linux-headers
#  - m4
#  - ncurses-dev
#  - openssl-dev
#  - perl
#  - pkgconfig
#  - zlib-dev
gmp-dev
linux-headers
m4
ncurses-dev
openssl-dev
perl
pkgconfig
zlib-dev
# All required OS packages found.

=-=- Synchronising pinned packages =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[datakit-bridge-local-git: local] Command started
[datakit-bridge-local-git] /home/opam/src/datakit/ already up-to-date
The following actions will be performed:
  - install datakit-github dev*          
  - install bin_prot       113.33.00+4.03
  - install camlzip        1.06          
  - install irmin-watcher  0.2.0         
  - install mstruct        1.3.2         
  - install crunch         1.4.1         
  - install uchar          0.0.1         
  - install ocamlgraph     1.8.7         
  - install uutf           1.0.0         
  - install git            1.9.3         
  - install jsonm          1.0.0         
  - install git-unix       1.7.1         
  - install ezjsonm        0.4.3         
  - install mirage-tc      0.3.0         
  - install irmin          0.12.0        
  - install irmin-unix     0.12.0        
===== 16 to install =====
Do you want to continue ? [Y/n] y

=-=- Gathering sources =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[bin_prot: http] Command started
[camlzip: http] Command started
[crunch: http] Command started
[bin_prot: http] Command started
[bin_prot.113.33.00+4.03] https://ocaml.janestreet.com/ocaml-core/113.33/files/bin_prot-113.33.00+4.03.tar.gz downloaded
[datakit-github: local] Command started
[datakit-github.dev] /home/opam/src/datakit/ already up-to-date
[ezjsonm: http] Command started
[camlzip: http] Command started
[camlzip.1.06] https://forge.ocamlcore.org/frs/download.php/1616/camlzip-1.06.tar.gz downloaded
[git: http] Command started
[crunch: http] Command started
[crunch.1.4.1] https://github.com/mirage/ocaml-crunch/archive/v1.4.1.tar.gz downloaded
[irmin: http] Command started
[ezjsonm: http] Command started
[ezjsonm.0.4.3] https://github.com/mirage/ezjsonm/archive/0.4.3.tar.gz downloaded
[irmin-watcher: http] Command started
[git: http] Command started
[git.1.9.3] https://github.com/mirage/ocaml-git/releases/download/1.9.3/git-1.9.3.tbz downloaded
[jsonm: http] Command started
[irmin: http] Command started
[irmin.0.12.0] https://github.com/mirage/irmin/releases/download/0.12.0/irmin-0.12.0.tbz downloaded
[mirage-tc: http] Command started
[irmin-watcher: http] Command started
[irmin-watcher.0.2.0] https://github.com/samoht/irmin-watcher/releases/download/0.2.0/irmin-watcher-0.2.0.tbz downloaded
[mstruct: http] Command started
[mirage-tc: http] Command started
[mirage-tc.0.3.0] https://github.com/mirage/mirage-tc/archive/0.3.0.tar.gz downloaded
[ocamlgraph: http] Command started
[ocamlgraph: http] Command started
[ocamlgraph.1.8.7] http://ocamlgraph.lri.fr/download/ocamlgraph-1.8.7.tar.gz downloaded
[uchar: http] Command started
[mstruct: http] Command started
[mstruct.1.3.2] https://github.com/mirage/ocaml-mstruct/archive/1.3.2.tar.gz downloaded
[uutf: http] Command started
[jsonm: http] Command started
[jsonm.1.0.0] http://erratique.ch/software/jsonm/releases/jsonm-1.0.0.tbz downloaded
[uutf: http] Command started
[uutf.1.0.0] http://erratique.ch/software/uutf/releases/uutf-1.0.0.tbz downloaded
[uchar: http] Command started
[uchar.0.0.1] https://github.com/ocaml/uchar/releases/download/v0.0.1/uchar-0.0.1.tbz downloaded

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[bin_prot: ./configure] Command started
[camlzip: make all] Command started
[crunch: ocaml setup.ml] Command started
[datakit-github: ocaml build] Command started
[camlzip: make allopt] Command started
[camlzip: make install-findlib] Command started
-> installed camlzip.1.06
[irmin-watcher: ocaml build] Command started
[bin_prot: make] Command started
[crunch: ocaml setup.ml] Command started
-> installed irmin-watcher.0.2.0
[mstruct: ./configure] Command started
[crunch: ocaml setup.ml] Command started
[mstruct: make] Command started
-> installed crunch.1.4.1
[ocamlgraph: touch] Command started
-> installed bin_prot.113.33.00+4.03
[uchar: ocaml] Command started
[ocamlgraph: ./configure] Command started
[uchar: ocaml] Command started
-> installed uchar.0.0.1
[uutf: ocaml build] Command started
[ocamlgraph: make] Command started
[mstruct: make install] Command started
-> installed uutf.1.0.0
[jsonm: ocaml build] Command started
-> installed jsonm.1.0.0
[ezjsonm: ./configure] Command started
-> installed mstruct.1.3.2
-> installed datakit-github.dev
[ezjsonm: make] Command started
[ezjsonm: make install] Command started
[ocamlgraph: make install-findlib] Command started
-> installed ocamlgraph.1.8.7
[git: ocaml build] Command started
-> installed ezjsonm.0.4.3
[mirage-tc: ./configure] Command started
[mirage-tc: make] Command started
[mirage-tc: make install] Command started
-> installed mirage-tc.0.3.0
-> installed git.1.9.3
-> installed git-unix.1.7.1
[irmin: ocaml build] Command started
-> installed irmin.0.12.0
-> installed irmin-unix.0.12.0
Done.
 ---> bc88ef714bd7
Removing intermediate container 1d81e68b72c7
Step 10/19 : COPY . /home/opam/src/datakit/
 ---> 9f94cd64b662
Removing intermediate container 3986ab75c56f
Step 11/19 : RUN sudo chown opam.nogroup -R /home/opam/src/datakit
 ---> Running in ba78bbd1f36d
 ---> 154958d30675
Removing intermediate container ba78bbd1f36d
Step 12/19 : RUN cd /home/opam/src/datakit &&     git diff && git status --porcelain &&     git checkout . && scripts/watermark.sh &&     git status --porcelain
 ---> Running in 159759518eeb
diff --git a/Dockerfile.bridge-local-git b/Dockerfile.bridge-local-git
index e335465..7cc343b 100644
--- a/Dockerfile.bridge-local-git
+++ b/Dockerfile.bridge-local-git
@@ -1,4 +1,4 @@
-FROM docker/datakit:client
+FROM sha256:f289b8fa3f0526044bde4e1deaac5a9bca028048da269234bc80f62e2d0e4755
 
 RUN opam pin add github --dev -n
 RUN opam pin add prometheus.dev /home/opam/src/datakit -n
 M Dockerfile.bridge-local-git
 M src/version.ml
 ---> 5bbb3d955a1c
Removing intermediate container 159759518eeb
Step 13/19 : RUN opam update datakit-bridge-local-git
 ---> Running in f04e311c5501

=-=- Synchronizing development packages -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[datakit-bridge-local-git: local] Command started
[datakit-bridge-local-git] /home/opam/src/datakit/ synchronized
 ---> 1fcea770fc46
Removing intermediate container f04e311c5501
Step 14/19 : RUN opam install datakit-bridge-local-git -vv
 ---> Running in 20f7af16df9f

=-=- Synchronising pinned packages =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[datakit-bridge-local-git: local] Command started
+ rsync "-rLptgoDrvc" "--exclude" ".git" "--exclude" "_darcs" "--exclude" ".hg" "--exclude" ".#*" "--delete" "/home/opam/src/datakit/" "/home/opam/.opam/4.03.0/packages.dev/datakit-bridge-local-git"
- sending incremental file list
- ./
- api/
- bridge/
- ci/
- ci/static/
- prometheus/
- src/
- 
- sent 8,522 bytes  received 67 bytes  17,178.00 bytes/sec
- total size is 1,281,367  speedup is 149.19
[datakit-bridge-local-git] /home/opam/src/datakit/ synchronized
The following actions will be performed:
  - install datakit-bridge-local-git dev*

=-=- Gathering sources =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[datakit-bridge-local-git: local] Command started
+ rsync "-rLptgoDrvc" "--exclude" ".git" "--exclude" "_darcs" "--exclude" ".hg" "--exclude" ".#*" "--delete" "/home/opam/src/datakit/" "/home/opam/.opam/4.03.0/packages.dev/datakit-bridge-local-git"
- sending incremental file list
- ./
- ci/
- 
- sent 8,507 bytes  received 52 bytes  17,118.00 bytes/sec
- total size is 1,281,367  speedup is 149.71
[datakit-bridge-local-git.dev] /home/opam/src/datakit/ synchronized

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[datakit-bridge-local-git: ocaml build] Command started
+ ocaml "pkg/pkg.ml" "build" "--pinned" "true" "-n" "datakit-bridge-local-git" (CWD=/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev)
- ocamlfind ocamlopt unix.cmxa -I /home/opam/.opam/4.03.0/lib/ocamlbuild /home/opam/.opam/4.03.0/lib/ocamlbuild/ocamlbuildlib.cmxa -linkpkg myocamlbuild.ml /home/opam/.opam/4.03.0/lib/ocamlbuild/ocamlbuild.cmx -o myocamlbuild
- ocamlfind ocamldep -package 'irmin.unix, irmin.git, irmin-watcher, datakit-github.client' -package 'cmdliner, logs, datakit-client, protocol-9p.unix, fmt.cli, fmt.tty, logs.cli' -package 'bytes lwt astring logs result cstruct fmt rresult' -modules bridge/local/main.ml > bridge/local/main.ml.depends
- ocamlfind ocamldep -package 'irmin.unix, irmin.git, irmin-watcher, datakit-github.client' -package 'cmdliner, logs, datakit-client, protocol-9p.unix, fmt.cli, fmt.tty, logs.cli' -package 'bytes lwt astring logs result cstruct fmt rresult' -modules bridge/local/main.mli > bridge/local/main.mli.depends
- ocamlfind ocamlc -c -g -annot -bin-annot -safe-string -strict-sequence -package 'irmin.unix, irmin.git, irmin-watcher, datakit-github.client' -package 'cmdliner, logs, datakit-client, protocol-9p.unix, fmt.cli, fmt.tty, logs.cli' -w A -package 'bytes lwt astring logs result cstruct fmt rresult' -I bridge/local -o bridge/local/main.cmi bridge/local/main.mli
- ocamlfind ocamldep -package 'irmin.unix, irmin.git, irmin-watcher, datakit-github.client' -package 'cmdliner, logs, datakit-client, protocol-9p.unix, fmt.cli, fmt.tty, logs.cli' -package 'bytes lwt astring logs result cstruct fmt rresult' -modules bridge/local/sync.ml > bridge/local/sync.ml.depends
- ocamlfind ocamldep -package 'irmin.unix, irmin.git, irmin-watcher, datakit-github.client' -package 'cmdliner, logs, datakit-client, protocol-9p.unix, fmt.cli, fmt.tty, logs.cli' -package 'bytes lwt astring logs result cstruct fmt rresult' -modules bridge/local/sync.mli > bridge/local/sync.mli.depends
- ocamlfind ocamlc -c -g -annot -bin-annot -safe-string -strict-sequence -package 'irmin.unix, irmin.git, irmin-watcher, datakit-github.client' -package 'cmdliner, logs, datakit-client, protocol-9p.unix, fmt.cli, fmt.tty, logs.cli' -w A -package 'bytes lwt astring logs result cstruct fmt rresult' -I bridge/local -o bridge/local/sync.cmi bridge/local/sync.mli
- ocamlfind ocamlopt -c -g -annot -bin-annot -safe-string -strict-sequence -package 'irmin.unix, irmin.git, irmin-watcher, datakit-github.client' -package 'cmdliner, logs, datakit-client, protocol-9p.unix, fmt.cli, fmt.tty, logs.cli' -w A -package 'bytes lwt astring logs result cstruct fmt rresult' -I bridge/local -o bridge/local/sync.cmx bridge/local/sync.ml
- ocamlfind ocamlopt -c -g -annot -bin-annot -safe-string -strict-sequence -package 'irmin.unix, irmin.git, irmin-watcher, datakit-github.client' -package 'cmdliner, logs, datakit-client, protocol-9p.unix, fmt.cli, fmt.tty, logs.cli' -w A -package 'bytes lwt astring logs result cstruct fmt rresult' -I bridge/local -o bridge/local/main.cmx bridge/local/main.ml
- ocamlfind ocamlopt -a -package 'irmin.unix, irmin.git, irmin-watcher, datakit-github.client' -package 'cmdliner, logs, datakit-client, protocol-9p.unix, fmt.cli, fmt.tty, logs.cli' -package 'bytes lwt astring logs result cstruct fmt rresult' bridge/local/sync.cmx bridge/local/main.cmx -o bridge/local/datakit-bridge-local-git.cmxa
- ocamlfind ocamlopt -shared -linkall -package 'irmin.unix, irmin.git, irmin-watcher, datakit-github.client' -package 'cmdliner, logs, datakit-client, protocol-9p.unix, fmt.cli, fmt.tty, logs.cli' -package 'bytes lwt astring logs result cstruct fmt rresult' bridge/local/datakit-bridge-local-git.cmxa -o bridge/local/datakit-bridge-local-git.cmxs
- ocamlfind ocamlc -c -g -annot -bin-annot -safe-string -strict-sequence -package 'irmin.unix, irmin.git, irmin-watcher, datakit-github.client' -package 'cmdliner, logs, datakit-client, protocol-9p.unix, fmt.cli, fmt.tty, logs.cli' -w A -package 'bytes lwt astring logs result cstruct fmt rresult' -I bridge/local -o bridge/local/main.cmo bridge/local/main.ml
- ocamlfind ocamlc -c -g -annot -bin-annot -safe-string -strict-sequence -package 'irmin.unix, irmin.git, irmin-watcher, datakit-github.client' -package 'cmdliner, logs, datakit-client, protocol-9p.unix, fmt.cli, fmt.tty, logs.cli' -w A -package 'bytes lwt astring logs result cstruct fmt rresult' -I bridge/local -o bridge/local/sync.cmo bridge/local/sync.ml
- ocamlfind ocamlc -a -package 'irmin.unix, irmin.git, irmin-watcher, datakit-github.client' -package 'cmdliner, logs, datakit-client, protocol-9p.unix, fmt.cli, fmt.tty, logs.cli' -package 'bytes lwt astring logs result cstruct fmt rresult' bridge/local/sync.cmo bridge/local/main.cmo -o bridge/local/datakit-bridge-local-git.cma
- ocamlfind ocamlopt -linkpkg -g -package 'irmin.unix, irmin.git, irmin-watcher, datakit-github.client' -package 'cmdliner, logs, datakit-client, protocol-9p.unix, fmt.cli, fmt.tty, logs.cli' -package 'bytes lwt astring logs result cstruct fmt rresult' bridge/local/sync.cmx bridge/local/main.cmx -o bridge/local/main.native
+ install "-m" "0755" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/bridge/local/main.native" "/home/opam/.opam/4.03.0/bin/datakit-bridge-local-git"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/bridge/local/datakit-bridge-local-git.a" "/home/opam/.opam/4.03.0/lib/datakit-bridge-local-git/datakit-bridge-local-git.a"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/bridge/local/datakit-bridge-local-git.cma" "/home/opam/.opam/4.03.0/lib/datakit-bridge-local-git/datakit-bridge-local-git.cma"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/bridge/local/datakit-bridge-local-git.cmxa" "/home/opam/.opam/4.03.0/lib/datakit-bridge-local-git/datakit-bridge-local-git.cmxa"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/bridge/local/datakit-bridge-local-git.cmxs" "/home/opam/.opam/4.03.0/lib/datakit-bridge-local-git/datakit-bridge-local-git.cmxs"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/bridge/local/main.cmi" "/home/opam/.opam/4.03.0/lib/datakit-bridge-local-git/main.cmi"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/bridge/local/main.cmti" "/home/opam/.opam/4.03.0/lib/datakit-bridge-local-git/main.cmti"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/bridge/local/main.cmx" "/home/opam/.opam/4.03.0/lib/datakit-bridge-local-git/main.cmx"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/bridge/local/main.mli" "/home/opam/.opam/4.03.0/lib/datakit-bridge-local-git/main.mli"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/bridge/local/sync.cmi" "/home/opam/.opam/4.03.0/lib/datakit-bridge-local-git/sync.cmi"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/bridge/local/sync.cmti" "/home/opam/.opam/4.03.0/lib/datakit-bridge-local-git/sync.cmti"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/bridge/local/sync.cmx" "/home/opam/.opam/4.03.0/lib/datakit-bridge-local-git/sync.cmx"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/bridge/local/sync.mli" "/home/opam/.opam/4.03.0/lib/datakit-bridge-local-git/sync.mli"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/datakit-bridge-local-git.opam" "/home/opam/.opam/4.03.0/lib/datakit-bridge-local-git/opam"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/pkg/META.bridge-local-git" "/home/opam/.opam/4.03.0/lib/datakit-bridge-local-git/META"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/CHANGES.md" "/home/opam/.opam/4.03.0/doc/datakit-bridge-local-git/CHANGES.md"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/LICENSE.md" "/home/opam/.opam/4.03.0/doc/datakit-bridge-local-git/LICENSE.md"
+ install "-m" "0644" "/home/opam/.opam/4.03.0/build/datakit-bridge-local-git.dev/_build/README.md" "/home/opam/.opam/4.03.0/doc/datakit-bridge-local-git/README.md"
-> installed datakit-bridge-local-git.dev
Done.
 ---> 0bc0653e9711
Removing intermediate container 20f7af16df9f
Step 15/19 : RUN opam config exec -- ocaml /home/opam/src/datakit/check-libev.ml
 ---> Running in a5cbf68471a5
 ---> f6057be32efb
Removing intermediate container a5cbf68471a5
Step 16/19 : RUN sudo cp $(opam config exec -- which datakit-bridge-local-git) /usr/bin/
 ---> Running in 4aca868ae910
 ---> c086016f8d06
Removing intermediate container 4aca868ae910
Step 17/19 : USER root
 ---> Running in b53e366291ec
 ---> 63fe862ae1c8
Removing intermediate container b53e366291ec
Step 18/19 : ENTRYPOINT /usr/bin/datakit-bridge-local-git
 ---> Running in 8b7b642d8af1
 ---> a17a6bbb27cb
Removing intermediate container 8b7b642d8af1
Step 19/19 : CMD -v --datakit=tcp:datakit:5640
 ---> Running in 19007973dfe8
 ---> c5839181fd1b
Removing intermediate container 19007973dfe8
Successfully built c5839181fd1b
[2017-01-25 15:09.11] Success
