=== Docker build Dockerfile.ci
[2017-01-30 09:11.32] Starting...
Cloning into '/tmp/with_clone1cf4c637'...
done.
HEAD is now at 2a31707 datakit: depend on irmin-http explicitly
Sending build context to Docker daemon 557.1 kBSending build context to Docker daemon 1.114 MBSending build context to Docker daemon 1.671 MBSending build context to Docker daemon 2.228 MBSending build context to Docker daemon 2.785 MBSending build context to Docker daemon 3.342 MBSending build context to Docker daemon 3.899 MBSending build context to Docker daemon 4.456 MBSending build context to Docker daemon 5.014 MBSending build context to Docker daemon 5.571 MBSending build context to Docker daemon 5.992 MB
Step 1/17 : FROM ocaml/opam:alpine-3.5_ocaml-4.04.0
alpine-3.5_ocaml-4.04.0: Pulling from ocaml/opam
0a8490d0dfd3: Already exists
058cd7f0b116: Already exists
471a883630bd: Pulling fs layer
63ee6943ea59: Pulling fs layer
63ee6943ea59: Waiting
471a883630bd: Verifying Checksum
471a883630bd: Download complete
471a883630bd: Pull complete
63ee6943ea59: Verifying Checksum
63ee6943ea59: Download complete
63ee6943ea59: Pull complete
Digest: sha256:aa72b91ed887e6e3161121642b32c7415c4f57047c5eb7011594cbd224773113
Status: Downloaded newer image for ocaml/opam:alpine-3.5_ocaml-4.04.0
 ---> d584e207406b
Step 2/17 : ENV OPAMYES 1
 ---> Running in ebc14e9d954c
 ---> 9de7042c1dcd
Removing intermediate container ebc14e9d954c
Step 3/17 : RUN sudo apk add tzdata
 ---> Running in 79124c673a4f
(1/1) Installing tzdata (2016i-r0)
Executing busybox-1.25.1-r0.trigger
OK: 585 MiB in 91 packages
 ---> b5373e968868
Removing intermediate container 79124c673a4f
Step 4/17 : RUN opam depext -i opam-devel && sudo cp $(opam config var "opam-devel:lib")/opam /usr/bin/opam
 ---> Running in 5829f6f8aac5
# Detecting depexts using flags: x86_64 linux alpine
# The following system packages are needed:
#  - m4
#  - perl
The following command needs to be run through "sudo":
    apk add m4 perl
(1/2) Installing m4 (1.4.17-r1)
(2/2) Installing perl (5.24.0-r0)
Executing busybox-1.25.1-r0.trigger
OK: 630 MiB in 93 packages
# OS packages installation successful
# Now letting OPAM install the packages
The following actions will be performed:
  - install conf-perl        1                                  [required by dose3]
  - install conf-m4          1                                  [required by ocamlfind]
  - install result           1.2                                [required by topkg]
  - install uchar            0.0.1                              [required by jsonm]
  - install opam-file-format 2.0~alpha5                         [required by opam-format]
  - install camlp4           4.04+system                        [required by cudf]
  - install ocamlfind        1.7.1                              [required by opam-core]
  - install typerex-build    1.99.17-beta                       [required by ocp-build]
  - install topkg            0.8.1                              [required by jsonm]
  - install ocamlgraph       1.8.7                              [required by dose3, opam-core]
  - install base-bytes       base                               [required by cppo, re]
  - install ocp-build        1.99.17-beta                       [required by opam-core]
  - install uutf             1.0.0                              [required by jsonm]
  - install re               1.7.1                              [required by dose3, opam-core]
  - install cppo             1.4.1                              [required by dose3]
  - install jsonm            1.0.0                              [required by opam-core]
  - install extlib-compat    1.7.0                              [required by dose3]
  - install opam-core        2.0~alpha5                         [required by opam-solver, opam-state]
  - install cudf             0.7                                [required by dose3]
  - install opam-format      2.0~alpha5                         [required by opam-solver, opam-state]
  - install dose3            5.0.1                              [required by opam-solver]
  - install opam-repository  2.0~alpha5                         [required by opam-state]
  - install opam-solver      2.0~alpha5                         [required by opam-client]
  - install opam-state       2.0~alpha5                         [required by opam-client]
  - install opam-client      2.0~alpha5                         [required by opam-devel]
  - install opam-devel       2.0~alpha5  
===== 26 to install =====

=-=- Gathering sources =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[camlp4: http] Command started
[cppo: http] Command started
[cudf: http] Command started
[cudf: http] Command started
[cudf.0.7] https://gforge.inria.fr/frs/download.php/33593/cudf-0.7.tar.gz downloaded
[dose3: http] Command started
[dose3: http] Command started
[dose3.5.0.1] https://gforge.inria.fr/frs/download.php/file/36063/dose3-5.0.1.tar.gz downloaded
[extlib-compat: http] Command started
[camlp4: http] Command started
[camlp4.4.04+system] https://github.com/ocaml/camlp4/archive/system.0.tar.gz downloaded
[jsonm: http] Command started
[jsonm: http] Command started
[jsonm.1.0.0] http://erratique.ch/software/jsonm/releases/jsonm-1.0.0.tbz downloaded
[ocamlfind: http] Command started
[cppo: http] Command started
[cppo.1.4.1] https://github.com/mjambon/cppo/archive/v1.4.1.tar.gz downloaded
[ocamlgraph: http] Command started
[ocamlfind: http] Command started
[ocamlfind.1.7.1] http://download.camlcity.org/download/findlib-1.7.1.tar.gz downloaded
[opam-client: http] Command started
[extlib-compat: http] Command started
[extlib-compat.1.7.0] https://github.com/ygrek/ocaml-extlib/archive/1.7.0.tar.gz downloaded
[opam-core: http] Command started
[ocamlgraph: http] Command started
[ocamlgraph.1.8.7] http://ocamlgraph.lri.fr/download/ocamlgraph-1.8.7.tar.gz downloaded
[opam-devel: http] Command started
[opam-client: http] Command started
[opam-client.2.0~alpha5] https://github.com/ocaml/opam/archive/2.0-alpha5+1.tar.gz downloaded
[opam-file-format: http] Command started
[opam-core: http] Command started
[opam-core.2.0~alpha5] https://github.com/ocaml/opam/archive/2.0-alpha5+1.tar.gz downloaded
[opam-format: http] Command started
[opam-devel: http] Command started
[opam-devel.2.0~alpha5] https://github.com/ocaml/opam/archive/2.0-alpha5+1.tar.gz downloaded
[opam-repository: http] Command started
[opam-file-format: http] Command started
[opam-file-format.2.0~alpha5] https://github.com/ocaml/opam-file-format/archive/2.0-alpha5.tar.gz downloaded
[opam-solver: http] Command started
[opam-format: http] Command started
[opam-format.2.0~alpha5] https://github.com/ocaml/opam/archive/2.0-alpha5+1.tar.gz downloaded
[opam-state: http] Command started
[opam-solver: http] Command started
[opam-solver.2.0~alpha5] https://github.com/ocaml/opam/archive/2.0-alpha5+1.tar.gz downloaded
[re: http] Command started
[opam-repository: http] Command started
[opam-repository.2.0~alpha5] https://github.com/ocaml/opam/archive/2.0-alpha5+1.tar.gz downloaded
[result: http] Command started
[result: http] Command started
[result.1.2] https://github.com/janestreet/result/archive/1.2.tar.gz downloaded
[topkg: http] Command started
[topkg: http] Command started
[topkg.0.8.1] http://erratique.ch/software/topkg/releases/topkg-0.8.1.tbz downloaded
[typerex-build: http] Command started
[opam-state: http] Command started
[opam-state.2.0~alpha5] https://github.com/ocaml/opam/archive/2.0-alpha5+1.tar.gz downloaded
[uchar: http] Command started
[re: http] Command started
[re.1.7.1] https://github.com/ocaml/ocaml-re/archive/1.7.1.tar.gz downloaded
[uutf: http] Command started
[uutf: http] Command started
[uutf.1.0.0] http://erratique.ch/software/uutf/releases/uutf-1.0.0.tbz downloaded
[uchar: http] Command started
[uchar.0.0.1] https://github.com/ocaml/uchar/releases/download/v0.0.1/uchar-0.0.1.tbz downloaded
[typerex-build: http] Command started
[typerex-build.1.99.17-beta] http://github.com/OCamlPro/typerex-build/archive/1.99.17-beta.tar.gz downloaded

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[camlp4: sh] Command started
[conf-m4: sh echo | m4] Command started
[conf-perl: perl] Command started
[opam-file-format: make all] Command started
-> installed conf-m4.1
[ocamlfind: ./configure] Command started
-> installed camlp4.4.04+system
[result: make] Command started
-> installed conf-perl.1
[uchar: ocaml] Command started
[uchar: ocaml] Command started
-> installed result.1.2
[ocamlfind: make all] Command started
[opam-file-format: make install] Command started
-> installed opam-file-format.2.0~alpha5
-> installed uchar.0.0.1
[ocamlfind: make opt] Command started
[ocamlfind: make install] Command started
[ocamlfind: install 0755] Command started
-> installed ocamlfind.1.7.1
-> installed base-bytes.base
[cppo: make opt] Command started
[ocamlgraph: touch] Command started
[re: ocaml setup.ml] Command started
[topkg: ocaml build] Command started
[ocamlgraph: ./configure] Command started
[ocamlgraph: make] Command started
[cppo: make ocamlbuild] Command started
[cppo: make install-lib] Command started
-> installed cppo.1.4.1
[extlib-compat: make build] Command started
[re: ocaml setup.ml] Command started
[extlib-compat: make install] Command started
-> installed extlib-compat.1.7.0
[cudf: make all] Command started
-> installed topkg.0.8.1
[typerex-build: ./configure] Command started
[typerex-build: make] Command started
[re: ocaml setup.ml] Command started
[ocamlgraph: make install-findlib] Command started
-> installed ocamlgraph.1.8.7
[uutf: ocaml build] Command started
-> installed uutf.1.0.0
[jsonm: ocaml build] Command started
-> installed re.1.7.1
-> installed jsonm.1.0.0
[cudf: make install] Command started
-> installed cudf.0.7
[dose3: ./configure] Command started
[dose3: make] Command started
[typerex-build: make install] Command started
-> installed typerex-build.1.99.17-beta
-> installed ocp-build.1.99.17-beta
[opam-core: ./configure] Command started
[opam-core: make opam-core] Command started
[opam-core: make opam-core.install] Command started
-> installed opam-core.2.0~alpha5
[opam-format: ./configure] Command started
[opam-format: make opam-format] Command started
[opam-format: make opam-format.install] Command started
-> installed opam-format.2.0~alpha5
[opam-repository: ./configure] Command started
[opam-repository: make opam-repository] Command started
[opam-repository: make opam-repository.install] Command started
-> installed opam-repository.2.0~alpha5
[opam-state: ./configure] Command started
[opam-state: make opam-state] Command started
[opam-state: make opam-state.install] Command started
-> installed opam-state.2.0~alpha5
[dose3: make installlib] Command started
-> installed dose3.5.0.1
[opam-solver: ./configure] Command started
[opam-solver: make opam-solver] Command started
[opam-solver: make opam-solver.install] Command started
-> installed opam-solver.2.0~alpha5
[opam-client: ./configure] Command started
[opam-client: make opam-client] Command started
[opam-client: make opam-client.install] Command started
-> installed opam-client.2.0~alpha5
[opam-devel: ./configure] Command started
[opam-devel: make opam-devel] Command started
[opam-devel: make opam-devel.install] Command started
-> installed opam-devel.2.0~alpha5
Done.

=-=- opam-devel.2.0~alpha5 installed successfully -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
=> The development version of opam has been successfuly compiled into
   /home/opam/.opam/system/lib/opam-devel. You should not run it from there,
   please install the binaries to your PATH, e.g. with
       sudo cp /home/opam/.opam/system/lib/opam-devel/* /usr/local/bin
 ---> c2b3d781c608
Removing intermediate container 5829f6f8aac5
Step 5/17 : RUN rm -rf ~/.opam
 ---> Running in 1d7dee1c9fe3
 ---> 6e1946554a77
Removing intermediate container 1d7dee1c9fe3
Step 6/17 : RUN opam init -y
 ---> Running in 6d8581dc061c
Checking for available remotes: rsync and local, git.
  - you won't be able to use mercurial repositories unless you install the hg command on your system.
  - you won't be able to use darcs repositories unless you install the darcs command on your system.


=-=- Fetching repository information =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Processing  1/1: [default: http]
[default] synchronized from https://opam.ocaml.org
[91m[NOTE] The repository 'default' will be *permanently* redirected to https://opam.ocaml.org/2.0~dev (opam-version >= "2.0~~")
[0m[default] synchronized from https://opam.ocaml.org/2.0~dev
[91m[WARNING] Errors in /home/opam/.opam/repo/default/repo, some fields have been ignored:
            - At /home/opam/.opam/repo/default/repo:5:0:
              Invalid field archive-mirrors

[0m[91m[WARNING] Errors in /home/opam/.opam/repo/default/repo, some fields have been ignored:
            - At /home/opam/.opam/repo/default/repo:5:0:
              Invalid field archive-mirrors

[0m

=-=- Required setup - please read -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

  In normal operation, opam only alters files within ~/.opam.

  However, to best integrate with your system, some environment variables
  should be set. If you allow it to, this initialisation step will update
  your sh configuration by adding the following line to ~/.profile:

    test -r /home/opam/.opam/opam-init/init.sh && . /home/opam/.opam/opam-init/init.sh > /dev/null 2> /dev/null || true

  Otherwise, every time you want to access your opam installation, you will
  need to run:

    eval `opam config env`

  You can always re-run this setup with 'opam init' later.

Do you want opam to modify ~/.profile ? [N/y/f]
(default is 'no', use 'f' to choose a different file) 

=-=- Gathering sources =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
-> installed base-bigarray.base
-> installed base-threads.base
-> installed base-unix.base
Processing  7/8: [ocaml-system: ocaml gen_ocaml_config.ml]
-> installed ocaml-system.4.04.0
Done.
# Run eval `opam config env` to update the current shell environment
 ---> c65d20ed6d1a
Removing intermediate container 6d8581dc061c
Step 7/17 : RUN opam install ocaml -y
 ---> Running in 08cfdfd3f7f1
The following actions will be performed:
  - install ocaml 4.04.0

=-=- Gathering sources =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Processing  1/2: [ocaml: ocaml unix.cma]
-> installed ocaml.4.04.0
Done.
# Run eval `opam config env` to update the current shell environment
 ---> ad56d0b53b1f
Removing intermediate container 08cfdfd3f7f1
Step 8/17 : RUN opam install depext -y
 ---> Running in df99c768a7dd
The following actions will be performed:
  - install ocamlbuild 0.9.3                                    [required by cmdliner]
  - install cmdliner   0.9.8                                    [required by depext]
  - install depext     1.0.2
===== 3 to install =====

=-=- Gathering sources =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Processing  1/3: [cmdliner: http]
Processing  2/3: [cmdliner: http] [depext: http]
Processing  3/3: [cmdliner: http] [depext: http] [ocamlbuild: http]
[cmdliner.0.9.8] http://erratique.ch/software/cmdliner/releases/cmdliner-0.9.8.tbz downloaded
Processing  3/3: [depext: http] [ocamlbuild: http]
[depext.1.0.2] https://github.com/ocaml/opam-depext/archive/1.0.2.tar.gz downloaded
Processing  3/3: [ocamlbuild: http]
[ocamlbuild.0.9.3] https://github.com/ocaml/ocamlbuild/archive/0.9.3.tar.gz downloaded

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Processing  1/6:
Processing  1/6: [ocamlbuild: make configure.make]
Processing  1/6: [ocamlbuild: make check-if-preinstalled]
-> installed ocamlbuild.0.9.3
Processing  3/6:
Processing  3/6: [cmdliner: ocaml]
-> installed cmdliner.0.9.8
Processing  5/6:
Processing  5/6: [depext: ocamlopt unix.cmxa]
-> installed depext.1.0.2
Done.
# Run eval `opam config env` to update the current shell environment
 ---> f46f233ad38b
Removing intermediate container df99c768a7dd
Step 9/17 : RUN opam pin add -yn prometheus https://github.com/docker/datakit.git &&     opam pin add -yn prometheus-app https://github.com/docker/datakit.git &&     opam pin add -yn datakit-client https://github.com/docker/datakit.git &&     opam pin add -yn session --dev &&     opam pin add -yn github --dev &&     opam pin add -yn datakit-github https://github.com/docker/datakit.git &&     opam pin add -yn datakit-server https://github.com/docker/datakit.git &&     opam pin add -yn datakit https://github.com/docker/datakit.git
 ---> Running in 3fc3a11f8dd9
Package prometheus does not exist, create as a NEW package ? [Y/n] y
[prometheus: git]
[prometheus: git]
[prometheus: git]
[prometheus: git]
[prometheus: git]
[prometheus: git]
[prometheus] git+https://github.com/docker/datakit.git changed
[91m[NOTE] Converting format of /home/opam/.opam/default/.opam-switch/packages.dev/prometheus/prometheus.opam from 1.2 to 2.0~alpha3
[0mprometheus is now pinned to git+https://github.com/docker/datakit.git (version ~dev)
Package prometheus-app does not exist, create as a NEW package ? [Y/n] y
[prometheus-app: git]
[prometheus-app: git]
[prometheus-app: git]
[prometheus-app: git]
[prometheus-app: git]
[prometheus-app: git]
[prometheus-app] git+https://github.com/docker/datakit.git changed
[91m[NOTE] Converting format of /home/opam/.opam/default/.opam-switch/packages.dev/prometheus-app/prometheus-app.opam from 1.2 to 2.0~alpha3
[0mprometheus-app is now pinned to git+https://github.com/docker/datakit.git (version ~dev)
[datakit-client: git]
[datakit-client: git]
[datakit-client: git]
[datakit-client: git]
[datakit-client: git]
[datakit-client: git]
[datakit-client] git+https://github.com/docker/datakit.git changed
[91m[NOTE] Converting format of /home/opam/.opam/default/.opam-switch/packages.dev/datakit-client/datakit-client.opam from 1.2 to 2.0~alpha3
[0mdatakit-client is now pinned to git+https://github.com/docker/datakit.git (version 0.8.0)
[session: git]
[session: git]
[session: git]
[session: git]
[session: git]
[session: git]
[session] git+https://github.com/inhabitedtype/ocaml-session.git changed
[91m[NOTE] Converting format of /home/opam/.opam/default/.opam-switch/packages.dev/session/opam/opam from 1.2 to 2.0~alpha3
[0msession is now pinned to git+https://github.com/inhabitedtype/ocaml-session.git (version 0.3.0)
[github: git]
[github: git]
[github: git]
[github: git]
[github: git]
[github: git]
[github] git+https://github.com/mirage/ocaml-github.git changed
[91m[NOTE] Converting format of /home/opam/.opam/default/.opam-switch/packages.dev/github/opam from 1.2 to 2.0~alpha3
[0mgithub is now pinned to git+https://github.com/mirage/ocaml-github.git (version 2.2.0)
[datakit-github: git]
[datakit-github: git]
[datakit-github: git]
[datakit-github: git]
[datakit-github: git]
[datakit-github: git]
[datakit-github] git+https://github.com/docker/datakit.git changed
[91m[NOTE] Converting format of /home/opam/.opam/default/.opam-switch/packages.dev/datakit-github/datakit-github.opam from 1.2 to 2.0~alpha3
[0mdatakit-github is now pinned to git+https://github.com/docker/datakit.git (version 0.8.1)
[datakit-server: git]
[datakit-server: git]
[datakit-server: git]
[datakit-server: git]
[datakit-server: git]
[datakit-server: git]
[datakit-server] git+https://github.com/docker/datakit.git changed
[91m[NOTE] Converting format of /home/opam/.opam/default/.opam-switch/packages.dev/datakit-server/datakit-server.opam from 1.2 to 2.0~alpha3
[0mdatakit-server is now pinned to git+https://github.com/docker/datakit.git (version 0.8.0)
[datakit: git]
[datakit: git]
[datakit: git]
[datakit: git]
[datakit: git]
[datakit: git]
[datakit] git+https://github.com/docker/datakit.git changed
[91m[NOTE] Converting format of /home/opam/.opam/default/.opam-switch/packages.dev/datakit/opam from 1.2 to 2.0~alpha3
[0mdatakit is now pinned to git+https://github.com/docker/datakit.git (version 0.8.0)
 ---> da5a67ff77fa
Removing intermediate container 3fc3a11f8dd9
Step 10/17 : ADD datakit-ci.opam /tmp/deps/opam
 ---> af5d8990608a
Removing intermediate container 7a1ce7e388f3
Step 11/17 : RUN opam pin add -y tmp /tmp/deps/opam -n
 ---> Running in 7f7390d36a8c
Package tmp does not exist, create as a NEW package ? [Y/n] y
[tmp: rsync]
[tmp.~dev] file:///tmp/deps/opam synchronized
[91m[NOTE] Converting format of /home/opam/.opam/default/.opam-switch/packages.dev/tmp/opam from 1.2 to 2.0~alpha3
[0mtmp is now pinned to file:///tmp/deps/opam (version ~dev)
 ---> 98be2199417e
Removing intermediate container 7f7390d36a8c
Step 12/17 : RUN opam depext tmp -y
 ---> Running in 3a8b7984203f
# Detecting depexts using flags: x86_64 linux alpine
# The following system packages are needed:
#  - gmp-dev
#  - linux-headers
#  - m4
#  - ncurses-dev
#  - openssl-dev
#  - pcre-dev
#  - perl
#  - pkgconfig
m4
ncurses-dev
perl
pkgconf
# The following new OS packages need to be installed: gmp-dev linux-headers openssl-dev pcre-dev
The following command needs to be run through "sudo":
    apk add gmp-dev linux-headers openssl-dev pcre-dev
(1/11) Installing libgmpxx (6.1.1-r0)
(2/11) Installing gmp-dev (6.1.1-r0)
(3/11) Installing linux-headers (4.4.6-r1)
(4/11) Installing zlib-dev (1.2.8-r2)
(5/11) Installing libcrypto1.0 (1.0.2k-r0)
(6/11) Installing libssl1.0 (1.0.2k-r0)
(7/11) Installing openssl-dev (1.0.2k-r0)
(8/11) Installing libpcre16 (8.39-r0)
(9/11) Installing libpcre32 (8.39-r0)
(10/11) Installing libpcrecpp (8.39-r0)
(11/11) Installing pcre-dev (8.39-r0)
Executing busybox-1.25.1-r0.trigger
OK: 659 MiB in 104 packages
# OS packages installation successful
 ---> 3c9e82f92ca9
Removing intermediate container 3a8b7984203f
Step 13/17 : RUN opam install --deps-only tmp -y
 ---> Running in da8789f50aa5

=-=- Synchronising pinned packages =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Processing  1/1: [tmp: rsync]
[tmp.~dev] file:///tmp/deps/opam already up-to-date
The following dependencies couldn't be met:
  - tmp -> mirage-channel
Your request can't be satisfied:
  - No package matching "mirage-channel" found

No solution found, exiting
The command '/bin/sh -c opam install --deps-only tmp -y' returned a non-zero code: 3
[2017-01-30 09:14.22] Failed: Command "docker" "build" "--pull" "-f" "Dockerfile.ci" "." exited with status 3
