=== Docker build Dockerfile
[2017-11-16 11:47.20] Starting...
Cloning into '/tmp/with_clonef801d6a'...
done.
warning: remote HEAD refers to nonexistent ref, unable to checkout.

HEAD is now at 8031c3d Update to latest versions of conduit, session and ocaml-github-hooks
Sending build context to Docker daemon 557.1 kBSending build context to Docker daemon 1.114 MBSending build context to Docker daemon 1.671 MBSending build context to Docker daemon 2.228 MBSending build context to Docker daemon 2.785 MBSending build context to Docker daemon 3.342 MBSending build context to Docker daemon 3.899 MBSending build context to Docker daemon 4.456 MBSending build context to Docker daemon 5.014 MBSending build context to Docker daemon 5.571 MBSending build context to Docker daemon 6.128 MBSending build context to Docker daemon 6.685 MBSending build context to Docker daemon 7.242 MBSending build context to Docker daemon 7.799 MBSending build context to Docker daemon 8.356 MBSending build context to Docker daemon 8.913 MBSending build context to Docker daemon 9.018 MB
Step 1/29 : FROM ocaml/opam-dev@sha256:f04c7fbe8fe103b77186f02a5b6c43f9a52e31af26b1211adf86698cfb5bb91f
sha256:f04c7fbe8fe103b77186f02a5b6c43f9a52e31af26b1211adf86698cfb5bb91f: Pulling from ocaml/opam-dev
Digest: sha256:f04c7fbe8fe103b77186f02a5b6c43f9a52e31af26b1211adf86698cfb5bb91f
Status: Image is up to date for ocaml/opam-dev@sha256:f04c7fbe8fe103b77186f02a5b6c43f9a52e31af26b1211adf86698cfb5bb91f
 ---> e190faf31c25
Step 2/29 : RUN git -C /home/opam/opam-repository fetch origin &&     git -C /home/opam/opam-repository reset 3bcfe6c8d --hard &&     opam update -u
 ---> Using cache
 ---> ec45e8a6cb61
Step 3/29 : ENV OPAMERRLOGLEN 0 OPAMYES 1
 ---> Using cache
 ---> a2b033586612
Step 4/29 : RUN sudo apk update && sudo apk add tzdata aspcud gmp-dev perl
 ---> Using cache
 ---> 7c36a98ed704
Step 5/29 : RUN opam depext -ui lwt inotify alcotest conf-libev asl win-eventlog     irmin-watcher mtime mirage-flow conduit hvsock prometheus-app git irmin     cmdliner protocol-9p rresult win-error named-pipe
 ---> Using cache
 ---> b242faee23da
Step 6/29 : COPY check-libev.ml /tmp/check-libev.ml
 ---> Using cache
 ---> 20fa80bbb595
Step 7/29 : RUN opam config exec -- ocaml /tmp/check-libev.ml
 ---> Using cache
 ---> 2c44a4805c00
Step 8/29 : COPY datakit.opam /home/opam/src/datakit/
 ---> Using cache
 ---> 4015dffe4749
Step 9/29 : COPY datakit-client.opam /home/opam/src/datakit/datakit-client.opam
 ---> Using cache
 ---> 82a6c6d682a9
Step 10/29 : COPY datakit-client-9p.opam /home/opam/src/datakit/datakit-client-9p.opam
 ---> Using cache
 ---> e85fa743d0ad
Step 11/29 : COPY datakit-server.opam /home/opam/src/datakit/datakit-server.opam
 ---> Using cache
 ---> 22aed5a5733e
Step 12/29 : COPY datakit-server-9p.opam /home/opam/src/datakit/datakit-server-9p.opam
 ---> Using cache
 ---> f771cdde6f18
Step 13/29 : RUN opam pin add datakit-server.dev /home/opam/src/datakit -yn &&     opam pin add datakit-server-9p.dev /home/opam/src/datakit -yn &&     opam pin add datakit-client.dev /home/opam/src/datakit -yn &&     opam pin add datakit-client-9p.dev /home/opam/src/datakit -yn &&     opam pin add datakit.dev /home/opam/src/datakit -yn
 ---> Using cache
 ---> fa8a61bc6b61
Step 14/29 : RUN opam depext -y datakit
 ---> Using cache
 ---> f2553e572708
Step 15/29 : RUN opam install alcotest
 ---> Using cache
 ---> d91dff0d71bf
Step 16/29 : RUN opam install datakit-client-9p datakit
 ---> Using cache
 ---> 40977a8f6548
Step 17/29 : COPY . /home/opam/src/datakit
 ---> 4cdd36cf47c3
Removing intermediate container d8889e4ea452
Step 18/29 : RUN sudo chown opam.nogroup -R /home/opam/src/datakit
 ---> Running in 2e7aba3d1589
 ---> 625bea0931ce
Removing intermediate container 2e7aba3d1589
Step 19/29 : RUN cd /home/opam/src/datakit &&     scripts/watermark.sh &&     git status --porcelain
 ---> Running in 149000c26b3e
 M src/version.ml
 ---> 6c27fc268b99
Error removing intermediate container 149000c26b3e: Driver aufs failed to remove root filesystem 149000c26b3eaa2161422aa4e85cb378840b25779fa2490f070f9e4b60dced31: rename /var/lib/docker/aufs/mnt/ea9e7d408c171b3287ab15f8e734649f70ccd143a603892f14f0dd5c3e5ffbb8 /var/lib/docker/aufs/mnt/ea9e7d408c171b3287ab15f8e734649f70ccd143a603892f14f0dd5c3e5ffbb8-removing: device or resource busy
Step 20/29 : RUN opam upgrade datakit-client datakit-client-9p datakit-server datakit-server-9p
 ---> Running in 6a6dc5d10cde

=-=- Synchronising pinned packages =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[datakit-client.dev] synchronised from file:///home/opam/src/datakit
[datakit-client-9p.dev] synchronised from file:///home/opam/src/datakit
[datakit-server.dev] synchronised from file:///home/opam/src/datakit
[datakit-server-9p.dev] synchronised from file:///home/opam/src/datakit

The following actions will be performed:
  - recompile datakit-server    dev* 
  - recompile datakit-client    dev* 
  - recompile datakit-server-9p dev* 
  - recompile datakit-client-9p dev* 
  - recompile datakit           dev* [uses datakit-server-9p]
===== 5 to recompile =====

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
-> removed   datakit-client-9p.dev
-> removed   datakit-client.dev
-> removed   datakit.dev
-> removed   datakit-server-9p.dev
-> removed   datakit-server.dev
-> installed datakit-client.dev
-> installed datakit-client-9p.dev
-> installed datakit-server.dev
-> installed datakit-server-9p.dev
-> installed datakit.dev
Done.
# Run eval $(opam env) to update the current shell environment
 ---> 86514ebc4fde
Error removing intermediate container 149000c26b3e: No such container: 149000c26b3eaa2161422aa4e85cb378840b25779fa2490f070f9e4b60dced31
Step 21/29 : RUN opam install datakit -ytv
 ---> Running in 83cb6a7d3dd6

=-=- Synchronising pinned packages =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Processing  1/1: [datakit.dev: rsync]
[datakit.dev] synchronised from file:///home/opam/src/datakit

The following actions will be performed:
  - recompile datakit dev* 

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Processing  1/3: [datakit: jbuilder build]
+ jbuilder "build" "-p" "datakit" "-j" "1" (CWD=/home/opam/.opam/default/.opam-switch/build/datakit.dev)
-     ocamldep src/datakit/bin/main.depends.ocamldep-output
-     ocamldep src/datakit/datakit.depends.ocamldep-output
-     ocamldep src/datakit/datakit.dependsi.ocamldep-output
-       ocamlc src/datakit/datakit__.{cmi,cmo,cmt}
-     ocamldep src/datakit-conduit/datakit_conduit.depends.ocamldep-output
-     ocamldep src/datakit-io/datakit_io.depends.ocamldep-output
-     ocamldep src/datakit-log/datakit_log.depends.ocamldep-output
-     ocamldep src/datakit-conduit/datakit_conduit.dependsi.ocamldep-output
-     ocamldep src/datakit-io/datakit_io.dependsi.ocamldep-output
-     ocamldep src/datakit-log/datakit_log.dependsi.ocamldep-output
-     ocamlopt src/datakit/datakit__.{cmx,o}
-       ocamlc src/datakit/datakit.{cmi,cmti}
-       ocamlc src/datakit/datakit__Blob.{cmi,cmti}
-       ocamlc src/datakit/datakit__Branch.{cmi,cmti}
-       ocamlc src/datakit/datakit__Metadata.{cmi,cmti}
-       ocamlc src/datakit/datakit__Path.{cmi,cmti}
-       ocamlc src/datakit-conduit/datakit_conduit.{cmi,cmti}
-       ocamlc src/datakit-io/datakit_io.{cmi,cmti}
-       ocamlc src/datakit-log/datakit_log.{cmi,cmti}
-       ocamlc src/datakit/datakit__Blob.{cmo,cmt}
-     ocamlopt src/datakit/datakit__Blob.{cmx,o}
-       ocamlc src/datakit/datakit__Branch.{cmo,cmt}
-     ocamlopt src/datakit/datakit__Branch.{cmx,o}
-       ocamlc src/datakit/datakit__Metadata.{cmo,cmt}
-     ocamlopt src/datakit/datakit__Metadata.{cmx,o}
-       ocamlc src/datakit/datakit__Path.{cmo,cmt}
-     ocamlopt src/datakit/datakit__Path.{cmx,o}
-       ocamlc src/datakit/datakit__Store.{cmi,cmti}
-     ocamlopt src/datakit-conduit/datakit_conduit.{cmx,o}
-     ocamlopt src/datakit-io/datakit_io.{cmx,o}
-     ocamlopt src/datakit-log/datakit_log.{cmx,o}
-       ocamlc src/datakit/datakit__Store.{cmo,cmt}
-     ocamlopt src/datakit/datakit__Store.{cmx,o}
-       ocamlc src/datakit/datakit__Dir.{cmi,cmti}
-       ocamlc src/datakit/datakit__Merge.{cmi,cmti}
-       ocamlc src/datakit/datakit__Remote.{cmi,cmti}
-     ocamlopt src/datakit-conduit/datakit_conduit.{a,cmxa}
-     ocamlopt src/datakit-io/datakit_io.{a,cmxa}
-     ocamlopt src/datakit-log/datakit_log.{a,cmxa}
-       ocamlc src/datakit/datakit__Dir.{cmo,cmt}
-     ocamlopt src/datakit/datakit__Dir.{cmx,o}
-       ocamlc src/datakit/datakit__Merge.{cmo,cmt}
-     ocamlopt src/datakit/datakit__Merge.{cmx,o}
-       ocamlc src/datakit/datakit__Remote.{cmo,cmt}
-     ocamlopt src/datakit/datakit__Remote.{cmx,o}
-       ocamlc src/datakit/bin/autopush.{cmi,cmo,cmt}
-       ocamlc src/datakit/bin/version.{cmi,cmo,cmt}
-       ocamlc src/datakit/datakit.{cmo,cmt}
-     ocamlopt src/datakit/datakit.{cmx,o}
-       ocamlc src/datakit/bin/main.{cmi,cmo,cmt}
-       ocamlc src/datakit/datakit.cma
-     ocamlopt src/datakit/bin/autopush.{cmx,o}
-     ocamlopt src/datakit/bin/version.{cmx,o}
-     ocamlopt src/datakit/datakit.{a,cmxa}
-     ocamlopt src/datakit/bin/main.{cmx,o}
-     ocamlopt src/datakit/datakit.cmxs
-     ocamlopt src/datakit/bin/main.exe
Processing  1/3: [datakit: jbuilder runtest]
+ jbuilder "runtest" "tests/datakit" (CWD=/home/opam/.opam/default/.opam-switch/build/datakit.dev)
-     ocamldep tests/datakit/test.depends.ocamldep-output
-     ocamldep src/datakit-server-9p/datakit_server_9p.dependsi.ocamldep-output
-     ocamldep api/ocaml/datakit_client.depends.ocamldep-output
-     ocamldep src/datakit-server-9p/datakit_server_9p.depends.ocamldep-output
-     ocamldep src/datakit-server/datakit_server.dependsi.ocamldep-output
-     ocamldep api/ocaml/datakit_client.dependsi.ocamldep-output
-     ocamldep src/datakit-server/datakit_server.depends.ocamldep-output
-     ocamldep tests/common/test.dependsi.ocamldep-output
-     ocamldep tests/common/test.depends.ocamldep-output
-     ocamldep tests/datakit/test.dependsi.ocamldep-output
-       ocamlc src/datakit-server/vfs.{cmi,cmti}
-       ocamlc api/ocaml/datakit_client.{cmi,cmti}
-       ocamlc src/datakit/datakit__Branch.{cmi,cmti}
-       ocamlc src/datakit/datakit__Metadata.{cmi,cmti}
-       ocamlc src/datakit/datakit__Blob.{cmi,cmti}
-       ocamlc src/datakit/datakit__Path.{cmi,cmti}
-       ocamlc src/datakit-server-9p/fs9p.{cmi,cmti}
-       ocamlc src/datakit-server-9p/fs9p_error.{cmi,cmti}
-       ocamlc tests/common/test_client.{cmi,cmti}
-     ocamlopt api/ocaml/datakit_client.{cmx,o}
-       ocamlc src/datakit/datakit.{cmi,cmti}
-     ocamlopt src/datakit-server/vfs.{cmx,o}
-       ocamlc src/datakit-conduit/datakit_conduit.{cmi,cmti}
-       ocamlc tests/common/test_utils.{cmi,cmo,cmt}
-     ocamlopt api/ocaml/datakit_client.{a,cmxa}
-     ocamlopt src/datakit/datakit__Branch.{cmx,o}
-     ocamlopt src/datakit/datakit__Metadata.{cmx,o}
-       ocamlc src/datakit/datakit__Store.{cmi,cmti}
-     ocamlopt src/datakit/datakit__Blob.{cmx,o}
-     ocamlopt src/datakit-server/datakit_server.{a,cmxa}
-     ocamlopt src/datakit-server-9p/fs9p_error.{cmx,o}
-     ocamlopt src/datakit/datakit__Path.{cmx,o}
-       ocamlc src/datakit/datakit__Dir.{cmi,cmti}
-       ocamlc src/datakit/datakit__Merge.{cmi,cmti}
-       ocamlc src/datakit/datakit__Remote.{cmi,cmti}
-       ocamlc tests/datakit/test.{cmi,cmti}
-     ocamlopt tests/common/test_utils.{cmx,o}
-     ocamlopt src/datakit-server-9p/fs9p.{cmx,o}
-     ocamlopt src/datakit/datakit__Store.{cmx,o}
-     ocamlopt src/datakit-server-9p/datakit_server_9p.{a,cmxa}
-     ocamlopt src/datakit-conduit/datakit_conduit.{cmx,o}
-     ocamlopt src/datakit/datakit__Dir.{cmx,o}
-     ocamlopt src/datakit/datakit__Merge.{cmx,o}
-     ocamlopt src/datakit/datakit__Remote.{cmx,o}
-     ocamlopt tests/common/test_client.{cmx,o}
-     ocamlopt tests/common/test.{a,cmxa}
-     ocamlopt src/datakit/datakit.{cmx,o}
-     ocamlopt tests/datakit/test.{cmx,o}
-     ocamlopt tests/datakit/test.exe
-         test alias tests/datakit/runtest
- /bin/sh: tput: not found
- stty: standard input: Not a tty
- Testing datakit.
- [33m ...[m                [36mserver[m           0   Writes.[32m[OK][m                [36mserver[m           0   Writes.
- [33m ...[m                [36mserver[m           1   RW.[32m[OK][m                [36mserver[m           1   RW.
- [33m ...[m                [36mserver[m           2   Blobs fast.[32m[OK][m                [36mserver[m           2   Blobs fast.
- [33m ...[m                [36mserver[m           3   Blobs random.[32m[OK][m                [36mserver[m           3   Blobs random.
- [33m ...[m                [36mserver[m           4   Streams.[32m[OK][m                [36mserver[m           4   Streams.
- [33m ...[m                [36mconduit[m          0   basic.[32m[OK][m                [36mconduit[m          0   basic.
- The full test results are available in `_build/_tests`.
- [32mTest Successful[m in 0.004s. 6 tests run.
+ jbuilder "runtest" "tests/datakit-9p" (CWD=/home/opam/.opam/default/.opam-switch/build/datakit.dev)
-     ocamldep tests/datakit-9p/test.depends.ocamldep-output
-     ocamldep api/ocaml/9p/datakit_client_9p.dependsi.ocamldep-output
-     ocamldep tests/datakit-9p/test.dependsi.ocamldep-output
-     ocamldep api/ocaml/9p/datakit_client_9p.depends.ocamldep-output
-       ocamlc api/ocaml/9p/datakit_client_9p.{cmi,cmti}
-       ocamlc tests/datakit-9p/test.{cmi,cmti}
-     ocamlopt api/ocaml/9p/datakit_client_9p.{cmx,o}
-     ocamlopt api/ocaml/9p/datakit_client_9p.{a,cmxa}
-     ocamlopt tests/datakit-9p/test.{cmx,o}
-     ocamlopt tests/datakit-9p/test.exe
-         test alias tests/datakit-9p/runtest
- /bin/sh: tput: not found
- stty: standard input: Not a tty
- Testing datakit-9p.
- [33m ...[m                [36mserver[m          0   Transaction.[32m[OK][m                [36mserver[m          0   Transaction.
- [33m ...[m                [36mserver[m          1   Qids.[32m[OK][m                [36mserver[m          1   Qids.
- [33m ...[m                [36mserver[m          2   Watch.[32m[OK][m                [36mserver[m          2   Watch.
- [33m ...[m                [36mserver[m          3   Range.[32m[OK][m                [36mserver[m          3   Range.
- [33m ...[m                [36mserver[m          4   Rename branch.[32m[OK][m                [36mserver[m          4   Rename branch.
- [33m ...[m                [36mserver[m          5   Rename file.[32m[OK][m                [36mserver[m          5   Rename file.
- [33m ...[m                [36mserver[m          6   Truncate.[32m[OK][m                [36mserver[m          6   Truncate.
- [33m ...[m                [36mserver[m          7   Parents.[32m[OK][m                [36mserver[m          7   Parents.
- [33m ...[m                [36mserver[m          8   Merge.[32m[OK][m                [36mserver[m          8   Merge.
- [33m ...[m                [36mserver[m          9   Merge_metadata.[32m[OK][m                [36mserver[m          9   Merge_metadata.
- [33m ...[m                [36mserver[m         10   Merge empty.[32m[OK][m                [36mserver[m         10   Merge empty.
- [33m ...[m                [36mserver[m         11   Conflicts.[32m[OK][m                [36mserver[m         11   Conflicts.
- [33m ...[m                [36mserver[m         12   Stable inodes.[32m[OK][m                [36mserver[m         12   Stable inodes.
- [33m ...[m                [36mserver[m         13   Remotes.[33m[SKIP][m              [36mserver[m         13   Remotes.
- [33m ...[m                [36mserver[m         14   Debug.[32m[OK][m                [36mserver[m         14   Debug.
- [33m ...[m                [36mclient[m          0   Transaction.[32m[OK][m                [36mclient[m          0   Transaction.
- [33m ...[m                [36mclient[m          1   Watch.[32m[OK][m                [36mclient[m          1   Watch.
- [33m ...[m                [36mclient[m          2   Make dirs.[32m[OK][m                [36mclient[m          2   Make dirs.
- [33m ...[m                [36mclient[m          3   Truncate.[32m[OK][m                [36mclient[m          3   Truncate.
- [33m ...[m                [36mclient[m          4   Parents.[32m[OK][m                [36mclient[m          4   Parents.
- [33m ...[m                [36mclient[m          5   Merge.[32m[OK][m                [36mclient[m          5   Merge.
- [33m ...[m                [36mclient[m          6   Diff.[32m[OK][m                [36mclient[m          6   Diff.
- [33m ...[m                [36mclient[m          7   Merge_metadata.[32m[OK][m                [36mclient[m          7   Merge_metadata.
- [33m ...[m                [36mclient[m          8   Merge empty.[32m[OK][m                [36mclient[m          8   Merge empty.
- [33m ...[m                [36mclient[m          9   Conflicts.[32m[OK][m                [36mclient[m          9   Conflicts.
- [33m ...[m                [36mclient[m         10   Large write.[32m[OK][m                [36mclient[m         10   Large write.
- [33m ...[m                [36mclient[m         11   Remove.[32m[OK][m                [36mclient[m         11   Remove.
- [33m ...[m                [36mclient[m         12   Remotes.[33m[SKIP][m              [36mclient[m         12   Remotes.
- [33m ...[m                [36mclient[m         13   Create_or_replace.[33m[SKIP][m              [36mclient[m         13   Create_or_replace.
- The full test results are available in `_build/_tests`.
- [32mTest Successful[m in 0.228s. 26 tests run.
-> compiled  datakit.dev
-> removed   datakit.dev
-> installed datakit.dev
Done.
# Run eval $(opam env) to update the current shell environment
 ---> 2bc92a5e4789
Error removing intermediate container 149000c26b3e: No such container: 149000c26b3eaa2161422aa4e85cb378840b25779fa2490f070f9e4b60dced31
Step 22/29 : RUN sudo cp $(opam config exec -- which datakit) /usr/bin/datakit &&     sudo cp $(opam config exec -- which datakit-mount) /usr/bin/datakit-mount
 ---> Running in 197ffaa09628
 ---> e43f4140d3fb
Removing intermediate container 197ffaa09628
Error removing intermediate container 149000c26b3e: No such container: 149000c26b3eaa2161422aa4e85cb378840b25779fa2490f070f9e4b60dced31
Step 23/29 : FROM alpine:3.5
3.5: Pulling from library/alpine
Digest: sha256:b007a354427e1880de9cdba533e8e57382b7f2853a68a478a17d447b302c219c
Status: Image is up to date for alpine:3.5
 ---> 3823b001394d
Removing intermediate container 83cb6a7d3dd6
Error removing intermediate container 149000c26b3e: No such container: 149000c26b3eaa2161422aa4e85cb378840b25779fa2490f070f9e4b60dced31
Step 24/29 : RUN apk add --no-cache libev gmp tzdata ca-certificates git openssh-client bash
 ---> Using cache
 ---> 6a3d76ce7ff5
Error removing intermediate container 149000c26b3e: No such container: 149000c26b3eaa2161422aa4e85cb378840b25779fa2490f070f9e4b60dced31
Step 25/29 : EXPOSE 5640
 ---> Using cache
 ---> a91a0c85728c
Removing intermediate container 6a6dc5d10cde
Error removing intermediate container 149000c26b3e: No such container: 149000c26b3eaa2161422aa4e85cb378840b25779fa2490f070f9e4b60dced31
Step 26/29 : ENTRYPOINT /usr/bin/datakit
 ---> Using cache
 ---> f5442b0964bd
Error removing intermediate container 149000c26b3e: No such container: 149000c26b3eaa2161422aa4e85cb378840b25779fa2490f070f9e4b60dced31
Step 27/29 : CMD --url=tcp://0.0.0.0:5640 --git=/data -v
 ---> Using cache
 ---> 6d0c61139dec
Error removing intermediate container 149000c26b3e: No such container: 149000c26b3eaa2161422aa4e85cb378840b25779fa2490f070f9e4b60dced31
Step 28/29 : COPY --from=0 /usr/bin/datakit /usr/bin/datakit
 ---> a5e33b8961e3
Error removing intermediate container 149000c26b3e: No such container: 149000c26b3eaa2161422aa4e85cb378840b25779fa2490f070f9e4b60dced31
Step 29/29 : COPY --from=0 /usr/bin/datakit-mount /usr/bin/datakit-mount
 ---> 70887433a727
Error removing intermediate container 149000c26b3e: No such container: 149000c26b3eaa2161422aa4e85cb378840b25779fa2490f070f9e4b60dced31
Successfully built 70887433a727
[2017-11-16 11:48.35] Success
